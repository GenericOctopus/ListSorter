import{d as bt,e as St,f as W}from"./chunk-EQDQRRRY.js";var qn=bt((An,On)=>{"use strict";(function(t){if(typeof An=="object")On.exports=t();else if(typeof define=="function"&&define.amd)define(t);else{var e;try{e=window}catch{e=self}e.SparkMD5=t()}})(function(t){"use strict";var e=function(d,f){return d+f&4294967295},n=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function r(d,f,o,u,l,_){return f=e(e(f,d),e(u,_)),e(f<<l|f>>>32-l,o)}function i(d,f){var o=d[0],u=d[1],l=d[2],_=d[3];o+=(u&l|~u&_)+f[0]-680876936|0,o=(o<<7|o>>>25)+u|0,_+=(o&u|~o&l)+f[1]-389564586|0,_=(_<<12|_>>>20)+o|0,l+=(_&o|~_&u)+f[2]+606105819|0,l=(l<<17|l>>>15)+_|0,u+=(l&_|~l&o)+f[3]-1044525330|0,u=(u<<22|u>>>10)+l|0,o+=(u&l|~u&_)+f[4]-176418897|0,o=(o<<7|o>>>25)+u|0,_+=(o&u|~o&l)+f[5]+1200080426|0,_=(_<<12|_>>>20)+o|0,l+=(_&o|~_&u)+f[6]-1473231341|0,l=(l<<17|l>>>15)+_|0,u+=(l&_|~l&o)+f[7]-45705983|0,u=(u<<22|u>>>10)+l|0,o+=(u&l|~u&_)+f[8]+1770035416|0,o=(o<<7|o>>>25)+u|0,_+=(o&u|~o&l)+f[9]-1958414417|0,_=(_<<12|_>>>20)+o|0,l+=(_&o|~_&u)+f[10]-42063|0,l=(l<<17|l>>>15)+_|0,u+=(l&_|~l&o)+f[11]-1990404162|0,u=(u<<22|u>>>10)+l|0,o+=(u&l|~u&_)+f[12]+1804603682|0,o=(o<<7|o>>>25)+u|0,_+=(o&u|~o&l)+f[13]-40341101|0,_=(_<<12|_>>>20)+o|0,l+=(_&o|~_&u)+f[14]-1502002290|0,l=(l<<17|l>>>15)+_|0,u+=(l&_|~l&o)+f[15]+1236535329|0,u=(u<<22|u>>>10)+l|0,o+=(u&_|l&~_)+f[1]-165796510|0,o=(o<<5|o>>>27)+u|0,_+=(o&l|u&~l)+f[6]-1069501632|0,_=(_<<9|_>>>23)+o|0,l+=(_&u|o&~u)+f[11]+643717713|0,l=(l<<14|l>>>18)+_|0,u+=(l&o|_&~o)+f[0]-373897302|0,u=(u<<20|u>>>12)+l|0,o+=(u&_|l&~_)+f[5]-701558691|0,o=(o<<5|o>>>27)+u|0,_+=(o&l|u&~l)+f[10]+38016083|0,_=(_<<9|_>>>23)+o|0,l+=(_&u|o&~u)+f[15]-660478335|0,l=(l<<14|l>>>18)+_|0,u+=(l&o|_&~o)+f[4]-405537848|0,u=(u<<20|u>>>12)+l|0,o+=(u&_|l&~_)+f[9]+568446438|0,o=(o<<5|o>>>27)+u|0,_+=(o&l|u&~l)+f[14]-1019803690|0,_=(_<<9|_>>>23)+o|0,l+=(_&u|o&~u)+f[3]-187363961|0,l=(l<<14|l>>>18)+_|0,u+=(l&o|_&~o)+f[8]+1163531501|0,u=(u<<20|u>>>12)+l|0,o+=(u&_|l&~_)+f[13]-1444681467|0,o=(o<<5|o>>>27)+u|0,_+=(o&l|u&~l)+f[2]-51403784|0,_=(_<<9|_>>>23)+o|0,l+=(_&u|o&~u)+f[7]+1735328473|0,l=(l<<14|l>>>18)+_|0,u+=(l&o|_&~o)+f[12]-1926607734|0,u=(u<<20|u>>>12)+l|0,o+=(u^l^_)+f[5]-378558|0,o=(o<<4|o>>>28)+u|0,_+=(o^u^l)+f[8]-2022574463|0,_=(_<<11|_>>>21)+o|0,l+=(_^o^u)+f[11]+1839030562|0,l=(l<<16|l>>>16)+_|0,u+=(l^_^o)+f[14]-35309556|0,u=(u<<23|u>>>9)+l|0,o+=(u^l^_)+f[1]-1530992060|0,o=(o<<4|o>>>28)+u|0,_+=(o^u^l)+f[4]+1272893353|0,_=(_<<11|_>>>21)+o|0,l+=(_^o^u)+f[7]-155497632|0,l=(l<<16|l>>>16)+_|0,u+=(l^_^o)+f[10]-1094730640|0,u=(u<<23|u>>>9)+l|0,o+=(u^l^_)+f[13]+681279174|0,o=(o<<4|o>>>28)+u|0,_+=(o^u^l)+f[0]-358537222|0,_=(_<<11|_>>>21)+o|0,l+=(_^o^u)+f[3]-722521979|0,l=(l<<16|l>>>16)+_|0,u+=(l^_^o)+f[6]+76029189|0,u=(u<<23|u>>>9)+l|0,o+=(u^l^_)+f[9]-640364487|0,o=(o<<4|o>>>28)+u|0,_+=(o^u^l)+f[12]-421815835|0,_=(_<<11|_>>>21)+o|0,l+=(_^o^u)+f[15]+530742520|0,l=(l<<16|l>>>16)+_|0,u+=(l^_^o)+f[2]-995338651|0,u=(u<<23|u>>>9)+l|0,o+=(l^(u|~_))+f[0]-198630844|0,o=(o<<6|o>>>26)+u|0,_+=(u^(o|~l))+f[7]+1126891415|0,_=(_<<10|_>>>22)+o|0,l+=(o^(_|~u))+f[14]-1416354905|0,l=(l<<15|l>>>17)+_|0,u+=(_^(l|~o))+f[5]-57434055|0,u=(u<<21|u>>>11)+l|0,o+=(l^(u|~_))+f[12]+1700485571|0,o=(o<<6|o>>>26)+u|0,_+=(u^(o|~l))+f[3]-1894986606|0,_=(_<<10|_>>>22)+o|0,l+=(o^(_|~u))+f[10]-1051523|0,l=(l<<15|l>>>17)+_|0,u+=(_^(l|~o))+f[1]-2054922799|0,u=(u<<21|u>>>11)+l|0,o+=(l^(u|~_))+f[8]+1873313359|0,o=(o<<6|o>>>26)+u|0,_+=(u^(o|~l))+f[15]-30611744|0,_=(_<<10|_>>>22)+o|0,l+=(o^(_|~u))+f[6]-1560198380|0,l=(l<<15|l>>>17)+_|0,u+=(_^(l|~o))+f[13]+1309151649|0,u=(u<<21|u>>>11)+l|0,o+=(l^(u|~_))+f[4]-145523070|0,o=(o<<6|o>>>26)+u|0,_+=(u^(o|~l))+f[11]-1120210379|0,_=(_<<10|_>>>22)+o|0,l+=(o^(_|~u))+f[2]+718787259|0,l=(l<<15|l>>>17)+_|0,u+=(_^(l|~o))+f[9]-343485551|0,u=(u<<21|u>>>11)+l|0,d[0]=o+d[0]|0,d[1]=u+d[1]|0,d[2]=l+d[2]|0,d[3]=_+d[3]|0}function s(d){var f=[],o;for(o=0;o<64;o+=4)f[o>>2]=d.charCodeAt(o)+(d.charCodeAt(o+1)<<8)+(d.charCodeAt(o+2)<<16)+(d.charCodeAt(o+3)<<24);return f}function a(d){var f=[],o;for(o=0;o<64;o+=4)f[o>>2]=d[o]+(d[o+1]<<8)+(d[o+2]<<16)+(d[o+3]<<24);return f}function h(d){var f=d.length,o=[1732584193,-271733879,-1732584194,271733878],u,l,_,k,T,D;for(u=64;u<=f;u+=64)i(o,s(d.substring(u-64,u)));for(d=d.substring(u-64),l=d.length,_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=0;u<l;u+=1)_[u>>2]|=d.charCodeAt(u)<<(u%4<<3);if(_[u>>2]|=128<<(u%4<<3),u>55)for(i(o,_),u=0;u<16;u+=1)_[u]=0;return k=f*8,k=k.toString(16).match(/(.*?)(.{0,8})$/),T=parseInt(k[2],16),D=parseInt(k[1],16)||0,_[14]=T,_[15]=D,i(o,_),o}function v(d){var f=d.length,o=[1732584193,-271733879,-1732584194,271733878],u,l,_,k,T,D;for(u=64;u<=f;u+=64)i(o,a(d.subarray(u-64,u)));for(d=u-64<f?d.subarray(u-64):new Uint8Array(0),l=d.length,_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=0;u<l;u+=1)_[u>>2]|=d[u]<<(u%4<<3);if(_[u>>2]|=128<<(u%4<<3),u>55)for(i(o,_),u=0;u<16;u+=1)_[u]=0;return k=f*8,k=k.toString(16).match(/(.*?)(.{0,8})$/),T=parseInt(k[2],16),D=parseInt(k[1],16)||0,_[14]=T,_[15]=D,i(o,_),o}function y(d){var f="",o;for(o=0;o<4;o+=1)f+=n[d>>o*8+4&15]+n[d>>o*8&15];return f}function m(d){var f;for(f=0;f<d.length;f+=1)d[f]=y(d[f]);return d.join("")}m(h("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(e=function(d,f){var o=(d&65535)+(f&65535),u=(d>>16)+(f>>16)+(o>>16);return u<<16|o&65535}),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&(function(){function d(f,o){return f=f|0||0,f<0?Math.max(f+o,0):Math.min(f,o)}ArrayBuffer.prototype.slice=function(f,o){var u=this.byteLength,l=d(f,u),_=u,k,T,D,N;return o!==t&&(_=d(o,u)),l>_?new ArrayBuffer(0):(k=_-l,T=new ArrayBuffer(k),D=new Uint8Array(T),N=new Uint8Array(this,l,k),D.set(N),T)}})();function c(d){return/[\u0080-\uFFFF]/.test(d)&&(d=unescape(encodeURIComponent(d))),d}function g(d,f){var o=d.length,u=new ArrayBuffer(o),l=new Uint8Array(u),_;for(_=0;_<o;_+=1)l[_]=d.charCodeAt(_);return f?l:u}function w(d){return String.fromCharCode.apply(null,new Uint8Array(d))}function S(d,f,o){var u=new Uint8Array(d.byteLength+f.byteLength);return u.set(new Uint8Array(d)),u.set(new Uint8Array(f),d.byteLength),o?u:u.buffer}function O(d){var f=[],o=d.length,u;for(u=0;u<o-1;u+=2)f.push(parseInt(d.substr(u,2),16));return String.fromCharCode.apply(String,f)}function p(){this.reset()}return p.prototype.append=function(d){return this.appendBinary(c(d)),this},p.prototype.appendBinary=function(d){this._buff+=d,this._length+=d.length;var f=this._buff.length,o;for(o=64;o<=f;o+=64)i(this._hash,s(this._buff.substring(o-64,o)));return this._buff=this._buff.substring(o-64),this},p.prototype.end=function(d){var f=this._buff,o=f.length,u,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_;for(u=0;u<o;u+=1)l[u>>2]|=f.charCodeAt(u)<<(u%4<<3);return this._finish(l,o),_=m(this._hash),d&&(_=O(_)),this.reset(),_},p.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},p.prototype.setState=function(d){return this._buff=d.buff,this._length=d.length,this._hash=d.hash,this},p.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},p.prototype._finish=function(d,f){var o=f,u,l,_;if(d[o>>2]|=128<<(o%4<<3),o>55)for(i(this._hash,d),o=0;o<16;o+=1)d[o]=0;u=this._length*8,u=u.toString(16).match(/(.*?)(.{0,8})$/),l=parseInt(u[2],16),_=parseInt(u[1],16)||0,d[14]=l,d[15]=_,i(this._hash,d)},p.hash=function(d,f){return p.hashBinary(c(d),f)},p.hashBinary=function(d,f){var o=h(d),u=m(o);return f?O(u):u},p.ArrayBuffer=function(){this.reset()},p.ArrayBuffer.prototype.append=function(d){var f=S(this._buff.buffer,d,!0),o=f.length,u;for(this._length+=d.byteLength,u=64;u<=o;u+=64)i(this._hash,a(f.subarray(u-64,u)));return this._buff=u-64<o?new Uint8Array(f.buffer.slice(u-64)):new Uint8Array(0),this},p.ArrayBuffer.prototype.end=function(d){var f=this._buff,o=f.length,u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l,_;for(l=0;l<o;l+=1)u[l>>2]|=f[l]<<(l%4<<3);return this._finish(u,o),_=m(this._hash),d&&(_=O(_)),this.reset(),_},p.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},p.ArrayBuffer.prototype.getState=function(){var d=p.prototype.getState.call(this);return d.buff=w(d.buff),d},p.ArrayBuffer.prototype.setState=function(d){return d.buff=g(d.buff,!0),p.prototype.setState.call(this,d)},p.ArrayBuffer.prototype.destroy=p.prototype.destroy,p.ArrayBuffer.prototype._finish=p.prototype._finish,p.ArrayBuffer.hash=function(d,f){var o=v(new Uint8Array(d)),u=m(o);return f?O(u):u},p})});var Dn=bt(Ot=>{"use strict";Ot.stringify=function(e){var n=[];n.push({obj:e});for(var r="",i,s,a,h,v,y,m,c,g,w,S;i=n.pop();)if(s=i.obj,a=i.prefix||"",h=i.val||"",r+=a,h)r+=h;else if(typeof s!="object")r+=typeof s>"u"?null:JSON.stringify(s);else if(s===null)r+="null";else if(Array.isArray(s)){for(n.push({val:"]"}),v=s.length-1;v>=0;v--)y=v===0?"":",",n.push({obj:s[v],prefix:y});n.push({val:"["})}else{m=[];for(c in s)s.hasOwnProperty(c)&&m.push(c);for(n.push({val:"}"}),v=m.length-1;v>=0;v--)g=m[v],w=s[g],S=v>0?",":"",S+=JSON.stringify(g)+":",n.push({obj:w,prefix:S});n.push({val:"{"})}return r};function Ne(t,e,n){var r=n[n.length-1];t===r.element&&(n.pop(),r=n[n.length-1]);var i=r.element,s=r.index;if(Array.isArray(i))i.push(t);else if(s===e.length-2){var a=e.pop();i[a]=t}else e.push(t)}Ot.parse=function(t){for(var e=[],n=[],r=0,i,s,a,h,v,y,m,c,g;;){if(i=t[r++],i==="}"||i==="]"||typeof i>"u"){if(e.length===1)return e.pop();Ne(e.pop(),e,n);continue}switch(i){case" ":case"	":case`
`:case":":case",":break;case"n":r+=3,Ne(null,e,n);break;case"t":r+=3,Ne(!0,e,n);break;case"f":r+=4,Ne(!1,e,n);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(s="",r--;;)if(a=t[r++],/[\d\.\-e\+]/.test(a))s+=a;else{r--;break}Ne(parseFloat(s),e,n);break;case'"':for(h="",v=void 0,y=0;m=t[r++],m!=='"'||v==="\\"&&y%2===1;)h+=m,v=m,v==="\\"?y++:y=0;Ne(JSON.parse('"'+h+'"'),e,n);break;case"[":c={element:[],index:e.length},e.push(c.element),n.push(c);break;case"{":g={element:{},index:e.length},e.push(g.element),n.push(g);break;default:throw new Error("unexpectedly reached end of input: "+i)}}}});var Fn=bt((so,qt)=>{"use strict";var $e=typeof Reflect=="object"?Reflect:null,kn=$e&&typeof $e.apply=="function"?$e.apply:function(e,n,r){return Function.prototype.apply.call(e,n,r)},tt;$e&&typeof $e.ownKeys=="function"?tt=$e.ownKeys:Object.getOwnPropertySymbols?tt=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:tt=function(e){return Object.getOwnPropertyNames(e)};function ei(t){console&&console.warn&&console.warn(t)}var Rn=Number.isNaN||function(e){return e!==e};function ee(){ee.init.call(this)}qt.exports=ee;qt.exports.once=ii;ee.EventEmitter=ee;ee.prototype._events=void 0;ee.prototype._eventsCount=0;ee.prototype._maxListeners=void 0;var Tn=10;function nt(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(ee,"defaultMaxListeners",{enumerable:!0,get:function(){return Tn},set:function(t){if(typeof t!="number"||t<0||Rn(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Tn=t}});ee.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};ee.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Rn(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Pn(t){return t._maxListeners===void 0?ee.defaultMaxListeners:t._maxListeners}ee.prototype.getMaxListeners=function(){return Pn(this)};ee.prototype.emit=function(e){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var a;if(n.length>0&&(a=n[0]),a instanceof Error)throw a;var h=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw h.context=a,h}var v=s[e];if(v===void 0)return!1;if(typeof v=="function")kn(v,this,n);else for(var y=v.length,m=Nn(v,y),r=0;r<y;++r)kn(m[r],this,n);return!0};function Ln(t,e,n,r){var i,s,a;if(nt(n),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),a=s[e]),a===void 0)a=s[e]=n,++t._eventsCount;else if(typeof a=="function"?a=s[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),i=Pn(t),i>0&&a.length>i&&!a.warned){a.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=a.length,ei(h)}return t}ee.prototype.addListener=function(e,n){return Ln(this,e,n,!1)};ee.prototype.on=ee.prototype.addListener;ee.prototype.prependListener=function(e,n){return Ln(this,e,n,!0)};function ti(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Bn(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=ti.bind(r);return i.listener=n,r.wrapFn=i,i}ee.prototype.once=function(e,n){return nt(n),this.on(e,Bn(this,e,n)),this};ee.prototype.prependOnceListener=function(e,n){return nt(n),this.prependListener(e,Bn(this,e,n)),this};ee.prototype.removeListener=function(e,n){var r,i,s,a,h;if(nt(n),i=this._events,i===void 0)return this;if(r=i[e],r===void 0)return this;if(r===n||r.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(s=-1,a=r.length-1;a>=0;a--)if(r[a]===n||r[a].listener===n){h=r[a].listener,s=a;break}if(s<0)return this;s===0?r.shift():ni(r,s),r.length===1&&(i[e]=r[0]),i.removeListener!==void 0&&this.emit("removeListener",e,h||n)}return this};ee.prototype.off=ee.prototype.removeListener;ee.prototype.removeAllListeners=function(e){var n,r,i;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r),a;for(i=0;i<s.length;++i)a=s[i],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(i=n.length-1;i>=0;i--)this.removeListener(e,n[i]);return this};function In(t,e,n){var r=t._events;if(r===void 0)return[];var i=r[e];return i===void 0?[]:typeof i=="function"?n?[i.listener||i]:[i]:n?ri(i):Nn(i,i.length)}ee.prototype.listeners=function(e){return In(this,e,!0)};ee.prototype.rawListeners=function(e){return In(this,e,!1)};ee.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):jn.call(t,e)};ee.prototype.listenerCount=jn;function jn(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}ee.prototype.eventNames=function(){return this._eventsCount>0?tt(this._events):[]};function Nn(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function ni(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function ri(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function ii(t,e){return new Promise(function(n,r){function i(a){t.removeListener(e,s),r(a)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",i),n([].slice.call(arguments))}$n(t,e,s,{once:!0}),e!=="error"&&si(t,i,{once:!0})})}function si(t,e,n){typeof t.on=="function"&&$n(t,"error",e,n)}function $n(t,e,n,r){if(typeof t.on=="function")r.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function i(s){r.once&&t.removeEventListener(e,i),n(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}});var ot=St(qn());var Ve,Xr=new Uint8Array(16);function At(){if(!Ve&&(Ve=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Ve))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ve(Xr)}var xn=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Yr(t){return typeof t=="string"&&xn.test(t)}var Cn=Yr;var fe=[];for(et=0;et<256;++et)fe.push((et+256).toString(16).substr(1));var et;function Zr(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(fe[t[e+0]]+fe[t[e+1]]+fe[t[e+2]]+fe[t[e+3]]+"-"+fe[t[e+4]]+fe[t[e+5]]+"-"+fe[t[e+6]]+fe[t[e+7]]+"-"+fe[t[e+8]]+fe[t[e+9]]+"-"+fe[t[e+10]]+fe[t[e+11]]+fe[t[e+12]]+fe[t[e+13]]+fe[t[e+14]]+fe[t[e+15]]).toLowerCase();if(!Cn(n))throw TypeError("Stringified UUID is invalid");return n}var En=Zr;function Vr(t,e,n){t=t||{};var r=t.random||(t.rng||At)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){n=n||0;for(var i=0;i<16;++i)e[n+i]=r[i];return e}return En(r)}var ze=Vr;var un=St(Dn()),xe=St(Fn());function ai(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer||typeof Blob<"u"&&t instanceof Blob}function oi(t){return t instanceof ArrayBuffer?t.slice(0):t.slice(0,t.size,t.type)}var vr=Function.prototype.toString,ui=vr.call(Object);function ci(t){var e=Object.getPrototypeOf(t);if(e===null)return!0;var n=e.constructor;return typeof n=="function"&&n instanceof n&&vr.call(n)==ui}function ue(t){var e,n,r;if(!t||typeof t!="object")return t;if(Array.isArray(t)){for(e=[],n=0,r=t.length;n<r;n++)e[n]=ue(t[n]);return e}if(t instanceof Date&&isFinite(t))return t.toISOString();if(ai(t))return oi(t);if(!ci(t))return t;e={};for(n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var i=ue(t[n]);typeof i<"u"&&(e[n]=i)}return e}function _r(t){var e=!1;return function(...n){if(e)throw new Error("once called more than once");e=!0,t.apply(this,n)}}function gr(t){return function(...e){e=ue(e);var n=this,r=typeof e[e.length-1]=="function"?e.pop():!1,i=new Promise(function(s,a){var h;try{var v=_r(function(y,m){y?a(y):s(m)});e.push(v),h=t.apply(n,e),h&&typeof h.then=="function"&&s(h)}catch(y){a(y)}});return r&&i.then(function(s){r(null,s)},r),i}}function fi(t,e,n){if(t.constructor.listeners("debug").length){for(var r=["api",t.name,e],i=0;i<n.length-1;i++)r.push(n[i]);t.constructor.emit("debug",r);var s=n[n.length-1];n[n.length-1]=function(a,h){var v=["api",t.name,e];v=v.concat(a?["error",a]:["success",h]),t.constructor.emit("debug",v),s(a,h)}}}function re(t,e){return gr(function(...n){if(this._closed)return Promise.reject(new Error("database is closed"));if(this._destroyed)return Promise.reject(new Error("database is destroyed"));var r=this;return fi(r,t,n),this.taskqueue.isReady?e.apply(this,n):new Promise(function(i,s){r.taskqueue.addTask(function(a){a?s(a):i(r[t].apply(r,n))})})})}function Ye(t,e){for(var n={},r=0,i=e.length;r<i;r++){var s=e[r];s in t&&(n[s]=t[s])}return n}var li=6;function Kn(t){return t}function di(t){return[{ok:t}]}function yr(t,e,n){var r=e.docs,i=new Map;r.forEach(function(O){i.has(O.id)?i.get(O.id).push(O):i.set(O.id,[O])});var s=i.size,a=0,h=new Array(s);function v(){var O=[];h.forEach(function(p){p.docs.forEach(function(d){O.push({id:p.id,docs:[d]})})}),n(null,{results:O})}function y(){++a===s&&v()}function m(O,p,d){h[O]={id:p,docs:d},y()}var c=[];i.forEach(function(O,p){c.push(p)});var g=0;function w(){if(!(g>=c.length)){var O=Math.min(g+li,c.length),p=c.slice(g,O);S(p,g),g+=p.length}}function S(O,p){O.forEach(function(d,f){var o=p+f,u=i.get(d),l=Ye(u[0],["atts_since","attachments"]);l.open_revs=u.map(function(k){return k.rev}),l.open_revs=l.open_revs.filter(Kn);var _=Kn;l.open_revs.length===0&&(delete l.open_revs,_=di),["revs","attachments","binary","ajax","latest"].forEach(function(k){k in e&&(l[k]=e[k])}),t.get(d,l,function(k,T){var D;k?D=[{error:k}]:D=_(T),m(o,d,D),w()})})}w()}var $t;try{localStorage.setItem("_pouch_check_localstorage",1),$t=!!localStorage.getItem("_pouch_check_localstorage")}catch{$t=!1}function ut(){return $t}var Ce=typeof queueMicrotask=="function"?queueMicrotask:function(e){Promise.resolve().then(e)},Ft=class extends xe.default{constructor(){super(),this._listeners={},ut()&&addEventListener("storage",e=>{this.emit(e.key)})}addListener(e,n,r,i){if(this._listeners[n])return;var s=!1,a=this;function h(){if(!a._listeners[n])return;if(s){s="waiting";return}s=!0;var v=Ye(i,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary","return_docs"]);function y(){s=!1}r.changes(v).on("change",function(m){m.seq>i.since&&!i.cancelled&&(i.since=m.seq,i.onChange(m))}).on("complete",function(){s==="waiting"&&Ce(h),s=!1}).on("error",y)}this._listeners[n]=h,this.on(e,h)}removeListener(e,n){n in this._listeners&&(super.removeListener(e,this._listeners[n]),delete this._listeners[n])}notifyLocalWindows(e){ut()&&(localStorage[e]=localStorage[e]==="a"?"b":"a")}notify(e){this.emit(e),this.notifyLocalWindows(e)}};function ye(t){if(typeof console<"u"&&typeof console[t]=="function"){var e=Array.prototype.slice.call(arguments,1);console[t].apply(console,e)}}function hi(t,e){var n=6e5;t=parseInt(t,10)||0,e=parseInt(e,10),e!==e||e<=t?e=(t||1)<<1:e=e+1,e>n&&(t=n>>1,e=n);var r=Math.random(),i=e-t;return~~(i*r+t)}function vi(t){var e=0;return t||(e=2e3),hi(t,e)}function Kt(t,e){ye("info","The above "+t+" is totally normal. "+e)}var te=class extends Error{constructor(e,n,r){super(),this.status=e,this.name=n,this.message=r,this.error=!0}toString(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})}},oo=new te(401,"unauthorized","Name or password is incorrect."),_i=new te(400,"bad_request","Missing JSON list of 'docs'"),_e=new te(404,"not_found","missing"),Me=new te(409,"conflict","Document update conflict"),pr=new te(400,"bad_request","_id field must contain a string"),gi=new te(412,"missing_id","_id is required for puts"),yi=new te(400,"bad_request","Only reserved document ids may start with underscore."),uo=new te(412,"precondition_failed","Database not open"),cn=new te(500,"unknown_error","Database encountered an unknown error"),mr=new te(500,"badarg","Some query argument is invalid"),co=new te(400,"invalid_request","Request was invalid"),pi=new te(400,"query_parse_error","Some query parameter is invalid"),Un=new te(500,"doc_validation","Bad special document member"),pt=new te(400,"bad_request","Something wrong with the request"),xt=new te(400,"bad_request","Document must be a JSON object"),fo=new te(404,"not_found","Database not found"),fn=new te(500,"indexed_db_went_bad","unknown"),lo=new te(500,"web_sql_went_bad","unknown"),ho=new te(500,"levelDB_went_went_bad","unknown"),vo=new te(403,"forbidden","Forbidden by design doc validate_doc_update function"),st=new te(400,"bad_request","Invalid rev format"),_o=new te(412,"file_exists","The database could not be created, the file already exists."),mi=new te(412,"missing_stub","A pre-existing attachment stub wasn't found"),go=new te(413,"invalid_url","Provided URL is invalid");function M(t,e){function n(r){for(var i=Object.getOwnPropertyNames(t),s=0,a=i.length;s<a;s++)typeof t[i[s]]!="function"&&(this[i[s]]=t[i[s]]);this.stack===void 0&&(this.stack=new Error().stack),r!==void 0&&(this.reason=r)}return n.prototype=te.prototype,new n(e)}function Ge(t){if(typeof t!="object"){var e=t;t=cn,t.data=e}return"error"in t&&t.error==="conflict"&&(t.name="conflict",t.status=409),"name"in t||(t.name=t.error||"unknown"),"status"in t||(t.status=500),"message"in t||(t.message=t.message||t.reason),"stack"in t||(t.stack=new Error().stack),t}function wi(t,e,n){try{return!t(e,n)}catch(i){var r="Filter function threw: "+i.toString();return M(pt,r)}}function ln(t){var e={},n=t.filter&&typeof t.filter=="function";return e.query=t.query_params,function(i){i.doc||(i.doc={});var s=n&&wi(t.filter,i.doc,e);if(typeof s=="object")return s;if(s)return!1;if(!t.include_docs)delete i.doc;else if(!t.attachments)for(var a in i.doc._attachments)Object.prototype.hasOwnProperty.call(i.doc._attachments,a)&&(i.doc._attachments[a].stub=!0);return!0}}function wr(t){var e;if(t?typeof t!="string"?e=M(pr):/^_/.test(t)&&!/^_(design|local)/.test(t)&&(e=M(yi)):e=M(gi),e)throw e}function qe(t){return typeof t._remote=="boolean"?t._remote:typeof t.type=="function"?(ye("warn","db.type() is deprecated and will be removed in a future version of PouchDB"),t.type()==="http"):!1}function bi(t,e){return"listenerCount"in t?t.listenerCount(e):xe.default.listenerCount(t,e)}function Ut(t){if(!t)return null;var e=t.split("/");return e.length===2?e:e.length===1?[t,t]:null}function Mn(t){var e=Ut(t);return e?e.join("/"):null}var Gn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Jn="queryKey",Si=/(?:^|&)([^&=]*)=?([^&]*)/g,Ai=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;function br(t){for(var e=Ai.exec(t),n={},r=14;r--;){var i=Gn[r],s=e[r]||"",a=["user","password"].indexOf(i)!==-1;n[i]=a?decodeURIComponent(s):s}return n[Jn]={},n[Gn[12]].replace(Si,function(h,v,y){v&&(n[Jn][v]=y)}),n}function dn(t,e){var n=[],r=[];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n.push(i),r.push(e[i]));return n.push(t),Function.apply(null,n).apply(null,r)}function ct(t,e,n){return t.get(e).catch(function(r){if(r.status!==404)throw r;return{}}).then(function(r){var i=r._rev,s=n(r);return s?(s._id=e,s._rev=i,Oi(t,s,n)):{updated:!1,rev:i}})}function Oi(t,e,n){return t.put(e).then(function(r){return{updated:!0,rev:r.rev}},function(r){if(r.status!==409)throw r;return ct(t,e._id,n)})}var hn=function(t){return atob(t)},Ze=function(t){return btoa(t)};function vn(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(s){if(s.name!=="TypeError")throw s;for(var n=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,r=new n,i=0;i<t.length;i+=1)r.append(t[i]);return r.getBlob(e.type)}}function qi(t){for(var e=t.length,n=new ArrayBuffer(e),r=new Uint8Array(n),i=0;i<e;i++)r[i]=t.charCodeAt(i);return n}function _n(t,e){return vn([qi(t)],{type:e})}function gn(t,e){return _n(hn(t),e)}function xi(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,i=0;i<r;i++)e+=String.fromCharCode(n[i]);return e}function Sr(t,e){var n=new FileReader,r=typeof n.readAsBinaryString=="function";n.onloadend=function(i){var s=i.target.result||"";if(r)return e(s);e(xi(s))},r?n.readAsBinaryString(t):n.readAsArrayBuffer(t)}function Ar(t,e){Sr(t,function(n){e(n)})}function yn(t,e){Ar(t,function(n){e(Ze(n))})}function Ci(t,e){var n=new FileReader;n.onloadend=function(r){var i=r.target.result||new ArrayBuffer(0);e(i)},n.readAsArrayBuffer(t)}var Ei=self.setImmediate||self.setTimeout,Di=32768;function ki(t){return Ze(t)}function Ti(t,e,n,r,i){(n>0||r<e.size)&&(e=e.slice(n,r)),Ci(e,function(s){t.append(s),i()})}function Ri(t,e,n,r,i){(n>0||r<e.length)&&(e=e.substring(n,r)),t.appendBinary(e),i()}function pn(t,e){var n=typeof t=="string",r=n?t.length:t.size,i=Math.min(Di,r),s=Math.ceil(r/i),a=0,h=n?new ot.default:new ot.default.ArrayBuffer,v=n?Ri:Ti;function y(){Ei(c)}function m(){var g=h.end(!0),w=ki(g);e(w),h.destroy()}function c(){var g=a*i,w=g+i;a++,a<s?v(h,t,g,w,y):v(h,t,g,w,m)}c()}function Or(t){return ot.default.hash(t)}function qr(t,e){if(!e)return ze().replace(/-/g,"").toLowerCase();var n=Object.assign({},t);return delete n._rev_tree,Or(JSON.stringify(n))}var mt=ze;function Be(t){for(var e,n,r,i=t.rev_tree.slice(),s;s=i.pop();){var a=s.ids,h=a[2],v=s.pos;if(h.length){for(var y=0,m=h.length;y<m;y++)i.push({pos:v+1,ids:h[y]});continue}var c=!!a[1].deleted,g=a[0];(!e||(r!==c?r:n!==v?n<v:e<g))&&(e=g,n=v,r=c)}return n+"-"+e}function Ie(t,e){for(var n=t.slice(),r;r=n.pop();)for(var i=r.pos,s=r.ids,a=s[2],h=e(a.length===0,i,s[0],r.ctx,s[1]),v=0,y=a.length;v<y;v++)n.push({pos:i+1,ids:a[v],ctx:h})}function Pi(t,e){return t.pos-e.pos}function mn(t){var e=[];Ie(t,function(i,s,a,h,v){i&&e.push({rev:s+"-"+a,pos:s,opts:v})}),e.sort(Pi).reverse();for(var n=0,r=e.length;n<r;n++)delete e[n].pos;return e}function wn(t){for(var e=Be(t),n=mn(t.rev_tree),r=[],i=0,s=n.length;i<s;i++){var a=n[i];a.rev!==e&&!a.opts.deleted&&r.push(a.rev)}return r}function Li(t){var e=[];return Ie(t.rev_tree,function(n,r,i,s,a){a.status==="available"&&!n&&(e.push(r+"-"+i),a.status="missing")}),e}function Bi(t,e){let n=[],r=t.slice(),i;for(;i=r.pop();){let{pos:s,ids:a}=i,h=`${s}-${a[0]}`,v=a[2];if(n.push(h),h===e){if(v.length!==0)throw new Error("The requested revision is not a leaf");return n.reverse()}(v.length===0||v.length>1)&&(n=[]);for(let y=0,m=v.length;y<m;y++)r.push({pos:s+1,ids:v[y]})}if(n.length===0)throw new Error("The requested revision does not exist");return n.reverse()}function xr(t){for(var e=[],n=t.slice(),r;r=n.pop();){var i=r.pos,s=r.ids,a=s[0],h=s[1],v=s[2],y=v.length===0,m=r.history?r.history.slice():[];m.push({id:a,opts:h}),y&&e.push({pos:i+1-m.length,ids:m});for(var c=0,g=v.length;c<g;c++)n.push({pos:i+1,ids:v[c],history:m})}return e.reverse()}function Ii(t,e){return t.pos-e.pos}function ji(t,e,n){for(var r=0,i=t.length,s;r<i;)s=r+i>>>1,n(t[s],e)<0?r=s+1:i=s;return r}function Ni(t,e,n){var r=ji(t,e,n);t.splice(r,0,e)}function zn(t,e){for(var n,r,i=e,s=t.length;i<s;i++){var a=t[i],h=[a.id,a.opts,[]];r?(r[2].push(h),r=h):n=r=h}return n}function $i(t,e){return t[0]<e[0]?-1:1}function Qn(t,e){for(var n=[{tree1:t,tree2:e}],r=!1;n.length>0;){var i=n.pop(),s=i.tree1,a=i.tree2;(s[1].status||a[1].status)&&(s[1].status=s[1].status==="available"||a[1].status==="available"?"available":"missing");for(var h=0;h<a[2].length;h++){if(!s[2][0]){r="new_leaf",s[2][0]=a[2][h];continue}for(var v=!1,y=0;y<s[2].length;y++)s[2][y][0]===a[2][h][0]&&(n.push({tree1:s[2][y],tree2:a[2][h]}),v=!0);v||(r="new_branch",Ni(s[2],a[2][h],$i))}}return{conflicts:r,tree:t}}function Cr(t,e,n){var r=[],i=!1,s=!1,a;if(!t.length)return{tree:[e],conflicts:"new_leaf"};for(var h=0,v=t.length;h<v;h++){var y=t[h];if(y.pos===e.pos&&y.ids[0]===e.ids[0])a=Qn(y.ids,e.ids),r.push({pos:y.pos,ids:a.tree}),i=i||a.conflicts,s=!0;else if(n!==!0){var m=y.pos<e.pos?y:e,c=y.pos<e.pos?e:y,g=c.pos-m.pos,w=[],S=[];for(S.push({ids:m.ids,diff:g,parent:null,parentIdx:null});S.length>0;){var O=S.pop();if(O.diff===0){O.ids[0]===c.ids[0]&&w.push(O);continue}for(var p=O.ids[2],d=0,f=p.length;d<f;d++)S.push({ids:p[d],diff:O.diff-1,parent:O.ids,parentIdx:d})}var o=w[0];o?(a=Qn(o.ids,c.ids),o.parent[2][o.parentIdx]=a.tree,r.push({pos:m.pos,ids:m.ids}),i=i||a.conflicts,s=!0):r.push(y)}else r.push(y)}return s||r.push(e),r.sort(Ii),{tree:r,conflicts:i||"internal_node"}}function Fi(t,e){for(var n=xr(t),r,i,s=0,a=n.length;s<a;s++){var h=n[s],v=h.ids,y;if(v.length>e){r||(r={});var m=v.length-e;y={pos:h.pos+m,ids:zn(v,m)};for(var c=0;c<m;c++){var g=h.pos+c+"-"+v[c].id;r[g]=!0}}else y={pos:h.pos,ids:zn(v,0)};i?i=Cr(i,y,!0).tree:i=[y]}return r&&Ie(i,function(w,S,O){delete r[S+"-"+O]}),{tree:i,revs:r?Object.keys(r):[]}}function Er(t,e,n){var r=Cr(t,e),i=Fi(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function Ki(t,e){for(var n=t.slice(),r=e.split("-"),i=parseInt(r[0],10),s=r[1],a;a=n.pop();){if(a.pos===i&&a.ids[0]===s)return!0;for(var h=a.ids[2],v=0,y=h.length;v<y;v++)n.push({pos:a.pos+1,ids:h[v]})}return!1}function Ui(t){return t.ids}function Ee(t,e){e||(e=Be(t));for(var n=e.substring(e.indexOf("-")+1),r=t.rev_tree.map(Ui),i;i=r.pop();){if(i[0]===n)return!!i[1].deleted;r=r.concat(i[2])}}function Le(t){return typeof t=="string"&&t.startsWith("_local/")}function Mi(t,e){for(var n=e.rev_tree.slice(),r;r=n.pop();){var i=r.pos,s=r.ids,a=s[0],h=s[1],v=s[2],y=v.length===0,m=r.history?r.history.slice():[];if(m.push({id:a,pos:i,opts:h}),y)for(var c=0,g=m.length;c<g;c++){var w=m[c],S=w.pos+"-"+w.id;if(S===t)return i+"-"+a}for(var O=0,p=v.length;O<p;O++)n.push({pos:i+1,ids:v[O],history:m})}throw new Error("Unable to resolve latest revision for id "+e.id+", rev "+t)}function Gi(t,e,n,r){try{t.emit("change",e,n,r)}catch(i){ye("error",'Error in .on("change", function):',i)}}function Ji(t,e,n){var r=[{rev:t._rev}];n.style==="all_docs"&&(r=mn(e.rev_tree).map(function(s){return{rev:s.rev}}));var i={id:e.id,changes:r,doc:t};return Ee(e,t._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=wn(e),i.doc._conflicts.length||delete i.doc._conflicts),i}var Mt=class extends xe.default{constructor(e,n,r){super(),this.db=e,n=n?ue(n):{};var i=n.complete=_r((h,v)=>{h?bi(this,"error")>0&&this.emit("error",h):this.emit("complete",v),this.removeAllListeners(),e.removeListener("destroyed",s)});r&&(this.on("complete",function(h){r(null,h)}),this.on("error",r));let s=()=>{this.cancel()};e.once("destroyed",s),n.onChange=(h,v,y)=>{this.isCancelled||Gi(this,h,v,y)};var a=new Promise(function(h,v){n.complete=function(y,m){y?v(y):h(m)}});this.once("cancel",function(){e.removeListener("destroyed",s),n.complete(null,{status:"cancelled"})}),this.then=a.then.bind(a),this.catch=a.catch.bind(a),this.then(function(h){i(null,h)},i),e.taskqueue.isReady?this.validateChanges(n):e.taskqueue.addTask(h=>{h?n.complete(h):this.isCancelled?this.emit("cancel"):this.validateChanges(n)})}cancel(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")}validateChanges(e){var n=e.complete;J._changesFilterPlugin?J._changesFilterPlugin.validate(e,r=>{if(r)return n(r);this.doChanges(e)}):this.doChanges(e)}doChanges(e){var n=e.complete;if(e=ue(e),"live"in e&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=Ji,e.since==="latest"&&(e.since="now"),e.since||(e.since=0),e.since==="now"){this.db.info().then(i=>{if(this.isCancelled){n(null,{status:"cancelled"});return}e.since=i.update_seq,this.doChanges(e)},n);return}if(J._changesFilterPlugin){if(J._changesFilterPlugin.normalize(e),J._changesFilterPlugin.shouldFilter(this,e))return J._changesFilterPlugin.filter(this,e)}else["doc_ids","filter","selector","view"].forEach(function(i){i in e&&ye("warn",'The "'+i+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});"descending"in e||(e.descending=!1),e.limit=e.limit===0?1:e.limit,e.complete=n;var r=this.db._changes(e);if(r&&typeof r.cancel=="function"){let i=this.cancel;this.cancel=(...s)=>{r.cancel(),i.apply(this,s)}}}};function Ct(t,e){return function(n,r){n||r[0]&&r[0].error?(n=n||r[0],n.docId=e,t(n)):t(null,r.length?r[0]:r)}}function zi(t){for(var e=0;e<t.length;e++){var n=t[e];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var s=r[i];n._attachments[s]=Ye(n._attachments[s],["data","digest","content_type","length","revpos","stub"])}}}function Qi(t,e){if(t._id===e._id){let n=t._revisions?t._revisions.start:0,r=e._revisions?e._revisions.start:0;return n-r}return t._id<e._id?-1:1}function Wi(t){var e={},n=[];return Ie(t,function(r,i,s,a){var h=i+"-"+s;return r&&(e[h]=0),a!==void 0&&n.push({from:a,to:h}),h}),n.reverse(),n.forEach(function(r){e[r.from]===void 0?e[r.from]=1+e[r.to]:e[r.from]=Math.min(e[r.from],1+e[r.to])}),e}function Hi(t){var e="limit"in t?t.keys.slice(t.skip,t.limit+t.skip):t.skip>0?t.keys.slice(t.skip):t.keys;t.keys=e,t.skip=0,delete t.limit,t.descending&&(e.reverse(),t.descending=!1)}function Dr(t){var e=t._compactionQueue[0],n=e.opts,r=e.callback;t.get("_local/compaction").catch(function(){return!1}).then(function(i){i&&i.last_seq&&(n.last_seq=i.last_seq),t._compact(n,function(s,a){s?r(s):r(null,a),Ce(function(){t._compactionQueue.shift(),t._compactionQueue.length&&Dr(t)})})})}function Xi(t,e,n){return t.get("_local/purges").then(function(r){let i=r.purgeSeq+1;return r.purges.push({docId:e,rev:n,purgeSeq:i}),r.purges.length>self.purged_infos_limit&&r.purges.splice(0,r.purges.length-self.purged_infos_limit),r.purgeSeq=i,r}).catch(function(r){if(r.status!==404)throw r;return{_id:"_local/purges",purges:[{docId:e,rev:n,purgeSeq:0}],purgeSeq:0}}).then(function(r){return t.put(r)})}function Yi(t){return t.charAt(0)==="_"?t+" is not a valid attachment name, attachment names cannot start with '_'":!1}function Et(t){return t===null||typeof t!="object"||Array.isArray(t)}var Zi=/^\d+-[^-]*$/;function Dt(t){return typeof t=="string"&&Zi.test(t)}var ft=class extends xe.default{_setup(){this.post=re("post",function(e,n,r){if(typeof n=="function"&&(r=n,n={}),Et(e))return r(M(xt));this.bulkDocs({docs:[e]},n,Ct(r,e._id))}).bind(this),this.put=re("put",function(e,n,r){if(typeof n=="function"&&(r=n,n={}),Et(e))return r(M(xt));if(wr(e._id),"_rev"in e&&!Dt(e._rev))return r(M(st));if(Le(e._id)&&typeof this._putLocal=="function")return e._deleted?this._removeLocal(e,r):this._putLocal(e,r);let i=a=>{typeof this._put=="function"&&n.new_edits!==!1?this._put(e,n,a):this.bulkDocs({docs:[e]},n,Ct(a,e._id))};n.force&&e._rev?(s(),i(function(a){var h=a?null:{ok:!0,id:e._id,rev:e._rev};r(a,h)})):i(r);function s(){var a=e._rev.split("-"),h=a[1],v=parseInt(a[0],10),y=v+1,m=qr();e._revisions={start:y,ids:[m,h]},e._rev=y+"-"+m,n.new_edits=!1}}).bind(this),this.putAttachment=re("putAttachment",function(e,n,r,i,s){var a=this;typeof s=="function"&&(s=i,i=r,r=null),typeof s>"u"&&(s=i,i=r,r=null),s||ye("warn","Attachment",n,"on document",e,"is missing content_type");function h(v){var y="_rev"in v?parseInt(v._rev,10):0;return v._attachments=v._attachments||{},v._attachments[n]={content_type:s,data:i,revpos:++y},a.put(v)}return a.get(e).then(function(v){if(v._rev!==r)throw M(Me);return h(v)},function(v){if(v.reason===_e.message)return h({_id:e});throw v})}).bind(this),this.removeAttachment=re("removeAttachment",function(e,n,r,i){this.get(e,(s,a)=>{if(s){i(s);return}if(a._rev!==r){i(M(Me));return}if(!a._attachments)return i();delete a._attachments[n],Object.keys(a._attachments).length===0&&delete a._attachments,this.put(a,i)})}).bind(this),this.remove=re("remove",function(e,n,r,i){var s;typeof n=="string"?(s={_id:e,_rev:n},typeof r=="function"&&(i=r,r={})):(s=e,typeof n=="function"?(i=n,r={}):(i=r,r=n)),r=r||{},r.was_delete=!0;var a={_id:s._id,_rev:s._rev||r.rev};if(a._deleted=!0,Le(a._id)&&typeof this._removeLocal=="function")return this._removeLocal(s,i);this.bulkDocs({docs:[a]},r,Ct(i,a._id))}).bind(this),this.revsDiff=re("revsDiff",function(e,n,r){typeof n=="function"&&(r=n,n={});var i=Object.keys(e);if(!i.length)return r(null,{});var s=0,a=new Map;function h(y,m){a.has(y)||a.set(y,{missing:[]}),a.get(y).missing.push(m)}function v(y,m){var c=e[y].slice(0);Ie(m,function(g,w,S,O,p){var d=w+"-"+S,f=c.indexOf(d);f!==-1&&(c.splice(f,1),p.status!=="available"&&h(y,d))}),c.forEach(function(g){h(y,g)})}i.forEach(function(y){this._getRevisionTree(y,function(m,c){if(m&&m.status===404&&m.message==="missing")a.set(y,{missing:e[y]});else{if(m)return r(m);v(y,c)}if(++s===i.length){var g={};return a.forEach(function(w,S){g[S]=w}),r(null,g)}})},this)}).bind(this),this.bulkGet=re("bulkGet",function(e,n){yr(this,e,n)}).bind(this),this.compactDocument=re("compactDocument",function(e,n,r){this._getRevisionTree(e,(i,s)=>{if(i)return r(i);var a=Wi(s),h=[],v=[];Object.keys(a).forEach(function(y){a[y]>n&&h.push(y)}),Ie(s,function(y,m,c,g,w){var S=m+"-"+c;w.status==="available"&&h.indexOf(S)!==-1&&v.push(S)}),this._doCompaction(e,v,r)})}).bind(this),this.compact=re("compact",function(e,n){typeof e=="function"&&(n=e,e={}),e=e||{},this._compactionQueue=this._compactionQueue||[],this._compactionQueue.push({opts:e,callback:n}),this._compactionQueue.length===1&&Dr(this)}).bind(this),this.get=re("get",function(e,n,r){if(typeof n=="function"&&(r=n,n={}),n=n||{},typeof e!="string")return r(M(pr));if(Le(e)&&typeof this._getLocal=="function")return this._getLocal(e,r);var i=[];let s=()=>{var v=[],y=i.length;if(!y)return r(null,v);i.forEach(m=>{this.get(e,{rev:m,revs:n.revs,latest:n.latest,attachments:n.attachments,binary:n.binary},function(c,g){if(c)v.push({missing:m});else{for(var w,S=0,O=v.length;S<O;S++)if(v[S].ok&&v[S].ok._rev===g._rev){w=!0;break}w||v.push({ok:g})}y--,y||r(null,v)})})};if(n.open_revs){if(n.open_revs==="all")this._getRevisionTree(e,function(v,y){if(v)return r(v);i=mn(y).map(function(m){return m.rev}),s()});else if(Array.isArray(n.open_revs)){i=n.open_revs;for(var a=0;a<i.length;a++){var h=i[a];if(!Dt(h))return r(M(st))}s()}else return r(M(cn,"function_clause"));return}return this._get(e,n,(v,y)=>{if(v)return v.docId=e,r(v);var m=y.doc,c=y.metadata,g=y.ctx;if(n.conflicts){var w=wn(c);w.length&&(m._conflicts=w)}if(Ee(c,m._rev)&&(m._deleted=!0),n.revs||n.revs_info){for(var S=m._rev.split("-"),O=parseInt(S[0],10),p=S[1],d=xr(c.rev_tree),f=null,o=0;o<d.length;o++){var u=d[o];let j=u.ids.findIndex(F=>F.id===p);var l=j===O-1;(l||!f&&j!==-1)&&(f=u)}if(!f)return v=new Error("invalid rev tree"),v.docId=e,r(v);let I=m._rev.split("-")[1],G=f.ids.findIndex(j=>j.id===I)+1;var _=f.ids.length-G;if(f.ids.splice(G,_),f.ids.reverse(),n.revs&&(m._revisions={start:f.pos+f.ids.length-1,ids:f.ids.map(function(j){return j.id})}),n.revs_info){var k=f.pos+f.ids.length;m._revs_info=f.ids.map(function(j){return k--,{rev:k+"-"+j.id,status:j.opts.status}})}}if(n.attachments&&m._attachments){var T=m._attachments,D=Object.keys(T).length;if(D===0)return r(null,m);Object.keys(T).forEach(I=>{this._getAttachment(m._id,I,T[I],{binary:n.binary,metadata:c,ctx:g},function(G,j){var F=m._attachments[I];F.data=j,delete F.stub,delete F.length,--D||r(null,m)})})}else{if(m._attachments)for(var N in m._attachments)Object.prototype.hasOwnProperty.call(m._attachments,N)&&(m._attachments[N].stub=!0);r(null,m)}})}).bind(this),this.getAttachment=re("getAttachment",function(e,n,r,i){r instanceof Function&&(i=r,r={}),this._get(e,r,(s,a)=>{if(s)return i(s);if(a.doc._attachments&&a.doc._attachments[n])r.ctx=a.ctx,r.binary=!0,r.metadata=a.metadata,this._getAttachment(e,n,a.doc._attachments[n],r,i);else return i(M(_e))})}).bind(this),this.allDocs=re("allDocs",function(e,n){if(typeof e=="function"&&(n=e,e={}),e.skip=typeof e.skip<"u"?e.skip:0,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return n(new TypeError("options.keys must be an array"));var r=["startkey","endkey","key"].filter(function(i){return i in e})[0];if(r){n(M(pi,"Query parameter `"+r+"` is not compatible with multi-get"));return}if(!qe(this)&&(Hi(e),e.keys.length===0))return this._allDocs({limit:0},n)}return this._allDocs(e,n)}).bind(this),this.close=re("close",function(e){return this._closed=!0,this.emit("closed"),this._close(e)}).bind(this),this.info=re("info",function(e){this._info((n,r)=>{if(n)return e(n);r.db_name=r.db_name||this.name,r.auto_compaction=!!(this.auto_compaction&&!qe(this)),r.adapter=this.adapter,e(null,r)})}).bind(this),this.id=re("id",function(e){return this._id(e)}).bind(this),this.bulkDocs=re("bulkDocs",function(e,n,r){if(typeof n=="function"&&(r=n,n={}),n=n||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return r(M(_i));for(var i=0;i<e.docs.length;++i){let v=e.docs[i];if(Et(v))return r(M(xt));if("_rev"in v&&!Dt(v._rev))return r(M(st))}var s;if(e.docs.forEach(function(v){v._attachments&&Object.keys(v._attachments).forEach(function(y){s=s||Yi(y),v._attachments[y].content_type||ye("warn","Attachment",y,"on document",v._id,"is missing content_type")})}),s)return r(M(pt,s));"new_edits"in n||("new_edits"in e?n.new_edits=e.new_edits:n.new_edits=!0);var a=this;!n.new_edits&&!qe(a)&&e.docs.sort(Qi),zi(e.docs);var h=e.docs.map(function(v){return v._id});this._bulkDocs(e,n,function(v,y){if(v)return r(v);if(n.new_edits||(y=y.filter(function(g){return g.error})),!qe(a))for(var m=0,c=y.length;m<c;m++)y[m].id=y[m].id||h[m];r(null,y)})}).bind(this),this.registerDependentDatabase=re("registerDependentDatabase",function(e,n){var r=ue(this.__opts);this.__opts.view_adapter&&(r.adapter=this.__opts.view_adapter);var i=new this.constructor(e,r);function s(a){return a.dependentDbs=a.dependentDbs||{},a.dependentDbs[e]?!1:(a.dependentDbs[e]=!0,a)}ct(this,"_local/_pouch_dependentDbs",s).then(function(){n(null,{db:i})}).catch(n)}).bind(this),this.destroy=re("destroy",function(e,n){typeof e=="function"&&(n=e,e={});var r="use_prefix"in this?this.use_prefix:!0;let i=()=>{this._destroy(e,(s,a)=>{if(s)return n(s);this._destroyed=!0,this.emit("destroyed"),n(null,a||{ok:!0})})};if(qe(this))return i();this.get("_local/_pouch_dependentDbs",(s,a)=>{if(s)return s.status!==404?n(s):i();var h=a.dependentDbs,v=this.constructor,y=Object.keys(h).map(m=>{var c=r?m.replace(new RegExp("^"+v.prefix),""):m;return new v(c,this.__opts).destroy()});Promise.all(y).then(i,n)})}).bind(this)}_compact(e,n){var r={return_docs:!1,last_seq:e.last_seq||0,since:e.last_seq||0},i=[],s,a=0;let h=m=>{this.activeTasks.update(s,{completed_items:++a}),i.push(this.compactDocument(m.id,0))},v=m=>{this.activeTasks.remove(s,m),n(m)},y=m=>{var c=m.last_seq;Promise.all(i).then(()=>ct(this,"_local/compaction",g=>!g.last_seq||g.last_seq<c?(g.last_seq=c,g):!1)).then(()=>{this.activeTasks.remove(s),n(null,{ok:!0})}).catch(v)};this.info().then(m=>{s=this.activeTasks.add({name:"database_compaction",total_items:m.update_seq-r.last_seq}),this.changes(r).on("change",h).on("complete",y).on("error",v)})}changes(e,n){return typeof e=="function"&&(n=e,e={}),e=e||{},e.return_docs="return_docs"in e?e.return_docs:!e.live,new Mt(this,e,n)}type(){return typeof this._type=="function"?this._type():this.adapter}};ft.prototype.purge=re("_purge",function(t,e,n){if(typeof this._purge>"u")return n(M(cn,"Purge is not implemented in the "+this.adapter+" adapter."));var r=this;r._getRevisionTree(t,(i,s)=>{if(i)return n(i);if(!s)return n(M(_e));let a;try{a=Bi(s,e)}catch(h){return n(h.message||h)}r._purge(t,a,(h,v)=>{if(h)return n(h);Xi(r,t,e).then(function(){return n(null,v)})})})});var Gt=class{constructor(){this.isReady=!1,this.failed=!1,this.queue=[]}execute(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()}fail(e){this.failed=e,this.execute()}ready(e){this.isReady=!0,this.db=e,this.execute()}addTask(e){this.queue.push(e),this.failed&&this.execute()}};function Vi(t,e){var n=t.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=J.adapters,i=J.preferredAdapters,s=J.prefix,a=e.adapter;if(!a)for(var h=0;h<i.length;++h){if(a=i[h],a==="idb"&&"websql"in r&&ut()&&localStorage["_pouch__websqldb_"+s+t]){ye("log",'PouchDB is downgrading "'+t+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}var v=r[a],y=v&&"use_prefix"in v?v.use_prefix:!0;return{name:y?s+t:t,adapter:a}}function es(t,e){t.prototype=Object.create(e.prototype,{constructor:{value:t}})}function kr(t,e){let n=function(...r){if(!(this instanceof n))return new n(...r);e.apply(this,r)};return es(n,t),n}function ts(t){function e(r){t.removeListener("closed",n),r||t.constructor.emit("destroyed",t.name)}function n(){t.removeListener("destroyed",e),t.constructor.emit("unref",t)}t.once("destroyed",e),t.once("closed",n),t.constructor.emit("ref",t)}var lt=class extends ft{constructor(e,n){super(),this._setup(e,n)}_setup(e,n){if(super._setup(),n=n||{},e&&typeof e=="object"&&(n=e,e=n.name,delete n.name),n.deterministic_revs===void 0&&(n.deterministic_revs=!0),this.__opts=n=ue(n),this.auto_compaction=n.auto_compaction,this.purged_infos_limit=n.purged_infos_limit||1e3,this.prefix=J.prefix,typeof e!="string")throw new Error("Missing/invalid DB name");var r=(n.prefix||"")+e,i=Vi(r,n);if(n.name=i.name,n.adapter=n.adapter||i.adapter,this.name=e,this._adapter=n.adapter,J.emit("debug",["adapter","Picked adapter: ",n.adapter]),!J.adapters[n.adapter]||!J.adapters[n.adapter].valid())throw new Error("Invalid Adapter: "+n.adapter);if(n.view_adapter&&(!J.adapters[n.view_adapter]||!J.adapters[n.view_adapter].valid()))throw new Error("Invalid View Adapter: "+n.view_adapter);this.taskqueue=new Gt,this.adapter=n.adapter,J.adapters[n.adapter].call(this,n,s=>{if(s)return this.taskqueue.fail(s);ts(this),this.emit("created",this),J.emit("created",this.name),this.taskqueue.ready(this)})}},J=kr(lt,function(t,e){lt.prototype._setup.call(this,t,e)}),Tr=fetch,Ke=Headers,Jt=class{constructor(){this.tasks={}}list(){return Object.values(this.tasks)}add(e){let n=ze();return this.tasks[n]={id:n,name:e.name,total_items:e.total_items,created_at:new Date().toJSON()},n}get(e){return this.tasks[e]}remove(e,n){return delete this.tasks[e],this.tasks}update(e,n){let r=this.tasks[e];if(typeof r<"u"){let i={id:r.id,name:r.name,created_at:r.created_at,total_items:n.total_items||r.total_items,completed_items:n.completed_items||r.completed_items,updated_at:new Date().toJSON()};this.tasks[e]=i}return this.tasks}};J.adapters={};J.preferredAdapters=[];J.prefix="_pouch_";var Wn=new xe.default;function ns(t){Object.keys(xe.default.prototype).forEach(function(n){typeof xe.default.prototype[n]=="function"&&(t[n]=Wn[n].bind(Wn))});var e=t._destructionListeners=new Map;t.on("ref",function(r){e.has(r.name)||e.set(r.name,[]),e.get(r.name).push(r)}),t.on("unref",function(r){if(e.has(r.name)){var i=e.get(r.name),s=i.indexOf(r);s<0||(i.splice(s,1),i.length>1?e.set(r.name,i):e.delete(r.name))}}),t.on("destroyed",function(r){if(e.has(r)){var i=e.get(r);e.delete(r),i.forEach(function(s){s.emit("destroyed",!0)})}})}ns(J);J.adapter=function(t,e,n){e.valid()&&(J.adapters[t]=e,n&&J.preferredAdapters.push(t))};J.plugin=function(t){if(typeof t=="function")t(J);else{if(typeof t!="object"||Object.keys(t).length===0)throw new Error('Invalid plugin: got "'+t+'", expected an object or a function');Object.keys(t).forEach(function(e){J.prototype[e]=t[e]})}return this.__defaults&&(J.__defaults=Object.assign({},this.__defaults)),J};J.defaults=function(t){let e=kr(J,function(n,r){r=r||{},n&&typeof n=="object"&&(r=n,n=r.name,delete r.name),r=Object.assign({},e.__defaults,r),J.call(this,n,r)});return e.preferredAdapters=J.preferredAdapters.slice(),Object.keys(J).forEach(function(n){n in e||(e[n]=J[n])}),e.__defaults=Object.assign({},this.__defaults,t),e};J.fetch=function(t,e){return Tr(t,e)};J.prototype.activeTasks=J.activeTasks=new Jt;var rs="9.0.0";function bn(t,e){for(var n=t,r=0,i=e.length;r<i;r++){var s=e[r];if(n=n[s],!n)break}return n}function is(t,e){return t<e?-1:t>e?1:0}function Sn(t){for(var e=[],n="",r=0,i=t.length;r<i;r++){var s=t[r];r>0&&t[r-1]==="\\"&&(s==="$"||s===".")?n=n.substring(0,n.length-1)+s:s==="."?(e.push(n),n=""):n+=s}return e.push(n),e}var ss=["$or","$nor","$not"];function Rr(t){return ss.indexOf(t)>-1}function Pr(t){return Object.keys(t)[0]}function as(t){return t[Pr(t)]}function He(t){var e={},n={$or:!0,$nor:!0};return t.forEach(function(r){Object.keys(r).forEach(function(i){var s=r[i];if(typeof s!="object"&&(s={$eq:s}),Rr(i))if(s instanceof Array){if(n[i]){n[i]=!1,e[i]=s;return}var a=[];e[i].forEach(function(v){Object.keys(s).forEach(function(y){var m=s[y],c=Math.max(Object.keys(v).length,Object.keys(m).length),g=He([v,m]);Object.keys(g).length<=c||a.push(g)})}),e[i]=a}else e[i]=He([s]);else{var h=e[i]=e[i]||{};Object.keys(s).forEach(function(v){var y=s[v];if(v==="$gt"||v==="$gte")return os(v,y,h);if(v==="$lt"||v==="$lte")return us(v,y,h);if(v==="$ne")return cs(y,h);if(v==="$eq")return fs(y,h);if(v==="$regex")return ls(y,h);h[v]=y})}})}),e}function os(t,e,n){typeof n.$eq<"u"||(typeof n.$gte<"u"?t==="$gte"?e>n.$gte&&(n.$gte=e):e>=n.$gte&&(delete n.$gte,n.$gt=e):typeof n.$gt<"u"?t==="$gte"?e>n.$gt&&(delete n.$gt,n.$gte=e):e>n.$gt&&(n.$gt=e):n[t]=e)}function us(t,e,n){typeof n.$eq<"u"||(typeof n.$lte<"u"?t==="$lte"?e<n.$lte&&(n.$lte=e):e<=n.$lte&&(delete n.$lte,n.$lt=e):typeof n.$lt<"u"?t==="$lte"?e<n.$lt&&(delete n.$lt,n.$lte=e):e<n.$lt&&(n.$lt=e):n[t]=e)}function cs(t,e){"$ne"in e?e.$ne.push(t):e.$ne=[t]}function fs(t,e){delete e.$gt,delete e.$gte,delete e.$lt,delete e.$lte,delete e.$ne,e.$eq=t}function ls(t,e){"$regex"in e?e.$regex.push(t):e.$regex=[t]}function Lr(t){for(var e in t){if(Array.isArray(t))for(var n in t)t[n].$and&&(t[n]=He(t[n].$and));var r=t[e];typeof r=="object"&&Lr(r)}return t}function Br(t,e){for(var n in t){n==="$and"&&(e=!0);var r=t[n];typeof r=="object"&&(e=Br(r,e))}return e}function ds(t){var e=ue(t);Br(e,!1)&&(e=Lr(e),"$and"in e&&(e=He(e.$and))),["$or","$nor"].forEach(function(a){a in e&&e[a].forEach(function(h){for(var v=Object.keys(h),y=0;y<v.length;y++){var m=v[y],c=h[m];(typeof c!="object"||c===null)&&(h[m]={$eq:c})}})}),"$not"in e&&(e.$not=He([e.$not]));for(var n=Object.keys(e),r=0;r<n.length;r++){var i=n[r],s=e[i];(typeof s!="object"||s===null)&&(s={$eq:s}),e[i]=s}return zt(e),e}function zt(t){Object.keys(t).forEach(function(e){var n=t[e];Array.isArray(n)?n.forEach(function(r){r&&typeof r=="object"&&zt(r)}):e==="$ne"?t.$ne=[n]:e==="$regex"?t.$regex=[n]:n&&typeof n=="object"&&zt(n)})}function hs(t,e,n){for(var r="",i=n-t.length;r.length<i;)r+=e;return r}function vs(t,e,n){var r=hs(t,e,n);return r+t}var Ir=-324,Qt=3,Wt="";function ie(t,e){if(t===e)return 0;t=je(t),e=je(e);var n=Ht(t),r=Ht(e);if(n-r!==0)return n-r;switch(typeof t){case"number":return t-e;case"boolean":return t<e?-1:1;case"string":return ws(t,e)}return Array.isArray(t)?ms(t,e):bs(t,e)}function je(t){switch(typeof t){case"undefined":return null;case"number":return t===1/0||t===-1/0||isNaN(t)?null:t;case"object":var e=t;if(Array.isArray(t)){var n=t.length;t=new Array(n);for(var r=0;r<n;r++)t[r]=je(e[r])}else{if(t instanceof Date)return t.toJSON();if(t!==null){t={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=e[i];typeof s<"u"&&(t[i]=je(s))}}}}return t}function _s(t){if(t!==null)switch(typeof t){case"boolean":return t?1:0;case"number":return Ss(t);case"string":return t.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var e=Array.isArray(t),n=e?t:Object.keys(t),r=-1,i=n.length,s="";if(e)for(;++r<i;)s+=we(n[r]);else for(;++r<i;){var a=n[r];s+=we(a)+we(t[a])}return s}return""}function we(t){var e="\0";return t=je(t),Ht(t)+Wt+_s(t)+e}function gs(t,e){var n=e,r,i=t[e]==="1";if(i)r=0,e++;else{var s=t[e]==="0";e++;var a="",h=t.substring(e,e+Qt),v=parseInt(h,10)+Ir;for(s&&(v=-v),e+=Qt;;){var y=t[e];if(y==="\0")break;a+=y,e++}a=a.split("."),a.length===1?r=parseInt(a,10):r=parseFloat(a[0]+"."+a[1]),s&&(r=r-10),v!==0&&(r=parseFloat(r+"e"+v))}return{num:r,length:e-n}}function ys(t,e){var n=t.pop();if(e.length){var r=e[e.length-1];n===r.element&&(e.pop(),r=e[e.length-1]);var i=r.element,s=r.index;if(Array.isArray(i))i.push(n);else if(s===t.length-2){var a=t.pop();i[a]=n}else t.push(n)}}function ps(t){for(var e=[],n=[],r=0;;){var i=t[r++];if(i==="\0"){if(e.length===1)return e.pop();ys(e,n);continue}switch(i){case"1":e.push(null);break;case"2":e.push(t[r]==="1"),r++;break;case"3":var s=gs(t,r);e.push(s.num),r+=s.length;break;case"4":for(var a="";;){var h=t[r];if(h==="\0")break;a+=h,r++}a=a.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),e.push(a);break;case"5":var v={element:[],index:e.length};e.push(v.element),n.push(v);break;case"6":var y={element:{},index:e.length};e.push(y.element),n.push(y);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}}}function ms(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=ie(t[r],e[r]);if(i!==0)return i}return t.length===e.length?0:t.length>e.length?1:-1}function ws(t,e){return t===e?0:t>e?1:-1}function bs(t,e){for(var n=Object.keys(t),r=Object.keys(e),i=Math.min(n.length,r.length),s=0;s<i;s++){var a=ie(n[s],r[s]);if(a!==0||(a=ie(t[n[s]],e[r[s]]),a!==0))return a}return n.length===r.length?0:n.length>r.length?1:-1}function Ht(t){var e=["boolean","number","string","object"],n=e.indexOf(typeof t);if(~n)return t===null?1:Array.isArray(t)?5:n<3?n+2:n+3;if(Array.isArray(t))return 5}function Ss(t){if(t===0)return"1";var e=t.toExponential().split(/e\+?/),n=parseInt(e[1],10),r=t<0,i=r?"0":"2",s=(r?-n:n)-Ir,a=vs(s.toString(),"0",Qt);i+=Wt+a;var h=Math.abs(parseFloat(e[0]));r&&(h=10-h);var v=h.toFixed(20);return v=v.replace(/\.?0+$/,""),i+=Wt+v,i}function As(t){function e(n){return t.map(function(r){var i=Pr(r),s=Sn(i),a=bn(n,s);return a})}return function(n,r){var i=e(n.doc),s=e(r.doc),a=ie(i,s);return a!==0?a:is(n.doc._id,r.doc._id)}}function Os(t,e,n){if(t=t.filter(function(a){return Ue(a.doc,e.selector,n)}),e.sort){var r=As(e.sort);t=t.sort(r),typeof e.sort[0]!="string"&&as(e.sort[0])==="desc"&&(t=t.reverse())}if("limit"in e||"skip"in e){var i=e.skip||0,s=("limit"in e?e.limit:t.length)+i;t=t.slice(i,s)}return t}function Ue(t,e,n){return n.every(function(r){var i=e[r],s=Sn(r),a=bn(t,s);return Rr(r)?qs(r,i,t):dt(i,t,s,a)})}function dt(t,e,n,r){return t?typeof t=="object"?Object.keys(t).every(function(i){var s=t[i];if(i.indexOf("$")===0)return Hn(i,e,s,n,r);var a=Sn(i);if(r===void 0&&typeof s!="object"&&a.length>0)return!1;var h=bn(r,a);return typeof s=="object"?dt(s,e,n,h):Hn("$eq",e,s,a,h)}):t===r:!0}function qs(t,e,n){return t==="$or"?e.some(function(r){return Ue(n,r,Object.keys(r))}):t==="$not"?!Ue(n,e,Object.keys(e)):!e.find(function(r){return Ue(n,r,Object.keys(r))})}function Hn(t,e,n,r,i){if(!Yn[t])throw new Error('unknown operator "'+t+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return Yn[t](e,n,r,i)}function Qe(t){return typeof t<"u"&&t!==null}function De(t){return typeof t<"u"}function xs(t,e){if(typeof t!="number"||parseInt(t,10)!==t)return!1;var n=e[0],r=e[1];return t%n===r}function Xn(t,e){return e.some(function(n){return t instanceof Array?t.some(function(r){return ie(n,r)===0}):ie(n,t)===0})}function Cs(t,e){return e.every(function(n){return t.some(function(r){return ie(n,r)===0})})}function Es(t,e){return t.length===e}function Ds(t,e){var n=new RegExp(e);return n.test(t)}function ks(t,e){switch(e){case"null":return t===null;case"boolean":return typeof t=="boolean";case"number":return typeof t=="number";case"string":return typeof t=="string";case"array":return t instanceof Array;case"object":return{}.toString.call(t)==="[object Object]"}}var Yn={$elemMatch:function(t,e,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.some(function(i){return Ue(i,e,Object.keys(e))}):r.some(function(i){return dt(e,t,n,i)})},$allMatch:function(t,e,n,r){return!Array.isArray(r)||r.length===0?!1:typeof r[0]=="object"&&r[0]!==null?r.every(function(i){return Ue(i,e,Object.keys(e))}):r.every(function(i){return dt(e,t,n,i)})},$eq:function(t,e,n,r){return De(r)&&ie(r,e)===0},$gte:function(t,e,n,r){return De(r)&&ie(r,e)>=0},$gt:function(t,e,n,r){return De(r)&&ie(r,e)>0},$lte:function(t,e,n,r){return De(r)&&ie(r,e)<=0},$lt:function(t,e,n,r){return De(r)&&ie(r,e)<0},$exists:function(t,e,n,r){return e?De(r):!De(r)},$mod:function(t,e,n,r){return Qe(r)&&xs(r,e)},$ne:function(t,e,n,r){return e.every(function(i){return ie(r,i)!==0})},$in:function(t,e,n,r){return Qe(r)&&Xn(r,e)},$nin:function(t,e,n,r){return Qe(r)&&!Xn(r,e)},$size:function(t,e,n,r){return Qe(r)&&Array.isArray(r)&&Es(r,e)},$all:function(t,e,n,r){return Array.isArray(r)&&Cs(r,e)},$regex:function(t,e,n,r){return Qe(r)&&typeof r=="string"&&e.every(function(i){return Ds(r,i)})},$type:function(t,e,n,r){return ks(r,e)}};function Ts(t,e){if(typeof e!="object")throw new Error("Selector error: expected a JSON object");e=ds(e);var n={doc:t},r=Os([n],{selector:e},Object.keys(e));return r&&r.length===1}function Rs(t){return dn(`"use strict";
return `+t+";",{})}function Ps(t){var e=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+t+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join(`
`);return dn(e,{})}function Ls(t,e){if(t.selector&&t.filter&&t.filter!=="_selector"){var n=typeof t.filter=="string"?t.filter:"function";return e(new Error('selector invalid for filter "'+n+'"'))}e()}function Bs(t){t.view&&!t.filter&&(t.filter="_view"),t.selector&&!t.filter&&(t.filter="_selector"),t.filter&&typeof t.filter=="string"&&(t.filter==="_view"?t.view=Mn(t.view):t.filter=Mn(t.filter))}function Is(t,e){return e.filter&&typeof e.filter=="string"&&!e.doc_ids&&!qe(t.db)}function js(t,e){var n=e.complete;if(e.filter==="_view"){if(!e.view||typeof e.view!="string"){var r=M(pt,"`view` filter parameter not found or invalid.");return n(r)}var i=Ut(e.view);t.db.get("_design/"+i[0],function(a,h){if(t.isCancelled)return n(null,{status:"cancelled"});if(a)return n(Ge(a));var v=h&&h.views&&h.views[i[1]]&&h.views[i[1]].map;if(!v)return n(M(_e,h.views?"missing json key: "+i[1]:"missing json key: views"));e.filter=Ps(v),t.doChanges(e)})}else if(e.selector)e.filter=function(a){return Ts(a,e.selector)},t.doChanges(e);else{var s=Ut(e.filter);t.db.get("_design/"+s[0],function(a,h){if(t.isCancelled)return n(null,{status:"cancelled"});if(a)return n(Ge(a));var v=h&&h.filters&&h.filters[s[1]];if(!v)return n(M(_e,h&&h.filters?"missing json key: "+s[1]:"missing json key: filters"));e.filter=Rs(v),t.doChanges(e)})}}function Ns(t){t._changesFilterPlugin={validate:Ls,normalize:Bs,shouldFilter:Is,filter:js}}J.plugin(Ns);J.version=rs;function $s(t,e,n){return new Promise(function(r){var i=vn([""]);let s;if(typeof n=="function"){let h=n(i);s=t.objectStore(e).put(h)}else{let a=n;s=t.objectStore(e).put(i,a)}s.onsuccess=function(){var a=navigator.userAgent.match(/Chrome\/(\d+)/),h=navigator.userAgent.match(/Edge\//);r(h||!a||parseInt(a[1],10)>=43)},s.onerror=t.onabort=function(a){a.preventDefault(),a.stopPropagation(),r(!1)}}).catch(function(){return!1})}function jr(t){return t.reduce(function(e,n){return e[n]=!0,e},{})}var Fs=jr(["_id","_rev","_access","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),Ks=jr(["_access","_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);function Zn(t){if(!/^\d+-/.test(t))return M(st);var e=t.indexOf("-"),n=t.substring(0,e),r=t.substring(e+1);return{prefix:parseInt(n,10),id:r}}function Us(t,e){for(var n=t.start-t.ids.length+1,r=t.ids,i=[r[0],e,[]],s=1,a=r.length;s<a;s++)i=[r[s],{status:"missing"},[i]];return[{pos:n,ids:i}]}function Nr(t,e,n){n||(n={deterministic_revs:!0});var r,i,s,a={status:"available"};if(t._deleted&&(a.deleted=!0),e)if(t._id||(t._id=mt()),i=qr(t,n.deterministic_revs),t._rev){if(s=Zn(t._rev),s.error)return s;t._rev_tree=[{pos:s.prefix,ids:[s.id,{status:"missing"},[[i,a,[]]]]}],r=s.prefix+1}else t._rev_tree=[{pos:1,ids:[i,a,[]]}],r=1;else if(t._revisions&&(t._rev_tree=Us(t._revisions,a),r=t._revisions.start,i=t._revisions.ids[0]),!t._rev_tree){if(s=Zn(t._rev),s.error)return s;r=s.prefix,i=s.id,t._rev_tree=[{pos:r,ids:[i,a,[]]}]}wr(t._id),t._rev=r+"-"+i;var h={metadata:{},data:{}};for(var v in t)if(Object.prototype.hasOwnProperty.call(t,v)){var y=v[0]==="_";if(y&&!Fs[v]){var m=M(Un,v);throw m.message=Un.message+": "+v,m}else y&&!Ks[v]?h.metadata[v.slice(1)]=t[v]:h.data[v]=t[v]}return h}function Ms(t){try{return hn(t)}catch{var e=M(mr,"Attachment is not a valid base64 string");return{error:e}}}function Gs(t,e,n){var r=Ms(t.data);if(r.error)return n(r.error);t.length=r.length,e==="blob"?t.data=_n(r,t.content_type):e==="base64"?t.data=Ze(r):t.data=r,pn(r,function(i){t.digest="md5-"+i,n()})}function Js(t,e,n){pn(t.data,function(r){t.digest="md5-"+r,t.length=t.data.size||t.data.length||0,e==="binary"?Ar(t.data,function(i){t.data=i,n()}):e==="base64"?yn(t.data,function(i){t.data=i,n()}):n()})}function zs(t,e,n){if(t.stub)return n();typeof t.data=="string"?Gs(t,e,n):Js(t,e,n)}function Qs(t,e,n){if(!t.length)return n();var r=0,i;t.forEach(function(a){var h=a.data&&a.data._attachments?Object.keys(a.data._attachments):[],v=0;if(!h.length)return s();function y(c){i=c,v++,v===h.length&&s()}for(var m in a.data._attachments)Object.prototype.hasOwnProperty.call(a.data._attachments,m)&&zs(a.data._attachments[m],e,y)});function s(){r++,t.length===r&&(i?n(i):n())}}function Ws(t,e,n,r,i,s,a,h){if(Ki(e.rev_tree,n.metadata.rev)&&!h)return r[i]=n,s();var v=e.winningRev||Be(e),y="deleted"in e?e.deleted:Ee(e,v),m="deleted"in n.metadata?n.metadata.deleted:Ee(n.metadata),c=/^1-/.test(n.metadata.rev);if(y&&!m&&h&&c){var g=n.data;g._rev=v,g._id=n.metadata.id,n=Nr(g,h)}var w=Er(e.rev_tree,n.metadata.rev_tree[0],t),S=h&&(y&&m&&w.conflicts!=="new_leaf"||!y&&w.conflicts!=="new_leaf"||y&&!m&&w.conflicts==="new_branch");if(S){var O=M(Me);return r[i]=O,s()}var p=n.metadata.rev;n.metadata.rev_tree=w.tree,n.stemmedRevs=w.stemmedRevs||[],e.rev_map&&(n.metadata.rev_map=e.rev_map);var d=Be(n.metadata),f=Ee(n.metadata,d),o=y===f?0:y<f?-1:1,u;p===d?u=f:u=Ee(n.metadata,p),a(n,d,f,u,!0,o,i,s)}function Hs(t){return t.metadata.rev_tree[0].ids[1].status==="missing"}function Xs(t,e,n,r,i,s,a,h,v){t=t||1e3;function y(O,p,d){var f=Be(O.metadata),o=Ee(O.metadata,f);if("was_delete"in h&&o)return s[p]=M(_e,"deleted"),d();var u=m&&Hs(O);if(u){var l=M(Me);return s[p]=l,d()}var _=o?0:1;a(O,f,o,o,!1,_,p,d)}var m=h.new_edits,c=new Map,g=0,w=e.length;function S(){++g===w&&v&&v()}e.forEach(function(O,p){if(O._id&&Le(O._id)){var d=O._deleted?"_removeLocal":"_putLocal";n[d](O,{ctx:i},function(o,u){s[p]=o||u,S()});return}var f=O.metadata.id;c.has(f)?(w--,c.get(f).push([O,p])):c.set(f,[[O,p]])}),c.forEach(function(O,p){var d=0;function f(){++d<O.length?o():S()}function o(){var u=O[d],l=u[0],_=u[1];if(r.has(p))Ws(t,r.get(p),l,s,_,f,a,m);else{var k=Er([],l.metadata.rev_tree[0],t);l.metadata.rev_tree=k.tree,l.stemmedRevs=k.stemmedRevs||[],y(l,_,f)}}o()})}var Ys=5,ae="document-store",le="by-sequence",ge="attach-store",Re="attach-seq-store",de="meta-store",Ae="local-store",kt="detect-blob-support";function Zs(t){try{return JSON.parse(t)}catch{return un.default.parse(t)}}function Vs(t){try{return JSON.stringify(t)}catch{return un.default.stringify(t)}}function Oe(t){return function(e){var n="unknown_error";e.target&&e.target.error&&(n=e.target.error.name||e.target.error.message),t(M(fn,n,e.type))}}function Xt(t,e,n){return{data:Vs(t),winningRev:e,deletedOrLocal:n?"1":"0",seq:t.seq,id:t.id}}function Pe(t){if(!t)return null;var e=Zs(t.data);return e.winningRev=t.winningRev,e.deleted=t.deletedOrLocal==="1",e.seq=t.seq,e}function ht(t){if(!t)return t;var e=t._doc_id_rev.lastIndexOf(":");return t._id=t._doc_id_rev.substring(0,e-1),t._rev=t._doc_id_rev.substring(e+1),delete t._doc_id_rev,t}function $r(t,e,n,r){n?r(t?typeof t!="string"?t:gn(t,e):vn([""],{type:e})):t?typeof t!="string"?Sr(t,function(i){r(Ze(i))}):r(t):r("")}function Fr(t,e,n,r){var i=Object.keys(t._attachments||{});if(!i.length)return r&&r();var s=0;function a(){++s===i.length&&r&&r()}function h(v,y){var m=v._attachments[y],c=m.digest,g=n.objectStore(ge).get(c);g.onsuccess=function(w){m.body=w.target.result.body,a()}}i.forEach(function(v){e.attachments&&e.include_docs?h(t,v):(t._attachments[v].stub=!0,a())})}function Yt(t,e){return Promise.all(t.map(function(n){if(n.doc&&n.doc._attachments){var r=Object.keys(n.doc._attachments);return Promise.all(r.map(function(i){var s=n.doc._attachments[i];if("body"in s){var a=s.body,h=s.content_type;return new Promise(function(v){$r(a,h,e,function(y){n.doc._attachments[i]=Object.assign(Ye(s,["digest","content_type"]),{data:y}),v()})})}}))}}))}function Kr(t,e,n){var r=[],i=n.objectStore(le),s=n.objectStore(ge),a=n.objectStore(Re),h=t.length;function v(){h--,h||y()}function y(){r.length&&r.forEach(function(m){var c=a.index("digestSeq").count(IDBKeyRange.bound(m+"::",m+"::\uFFFF",!1,!1));c.onsuccess=function(g){var w=g.target.result;w||s.delete(m)}})}t.forEach(function(m){var c=i.index("_doc_id_rev"),g=e+"::"+m;c.getKey(g).onsuccess=function(w){var S=w.target.result;if(typeof S!="number")return v();i.delete(S);var O=a.index("seq").openCursor(IDBKeyRange.only(S));O.onsuccess=function(p){var d=p.target.result;if(d){var f=d.value.digestSeq.split("::")[0];r.push(f),a.delete(d.primaryKey),d.continue()}else v()}}})}function be(t,e,n){try{return{txn:t.transaction(e,n)}}catch(r){return{error:r}}}var We=new Ft;function ea(t,e,n,r,i,s){for(var a=e.docs,h,v,y,m,c,g,w,S,O=0,p=a.length;O<p;O++){var d=a[O];d._id&&Le(d._id)||(d=a[O]=Nr(d,n.new_edits,t),d.error&&!w&&(w=d))}if(w)return s(w);var f=!1,o=0,u=new Array(a.length),l=new Map,_=!1,k=r._meta.blobSupport?"blob":"base64";Qs(a,k,function(x){if(x)return s(x);T()});function T(){var x=[ae,le,ge,Ae,Re,de],R=be(i,x,"readwrite");if(R.error)return s(R.error);h=R.txn,h.onabort=Oe(s),h.ontimeout=Oe(s),h.oncomplete=j,v=h.objectStore(ae),y=h.objectStore(le),m=h.objectStore(ge),c=h.objectStore(Re),g=h.objectStore(de),g.get(de).onsuccess=function(B){S=B.target.result,I()},z(function(B){if(B)return _=!0,s(B);G()})}function D(){f=!0,I()}function N(){Xs(t.revs_limit,a,r,l,h,u,Q,n,D)}function I(){!S||!f||(S.docCount+=o,g.put(S))}function G(){if(!a.length)return;var x=0;function R(){++x===a.length&&N()}function B(L){var $=Pe(L.target.result);$&&l.set($.id,$),R()}for(var U=0,P=a.length;U<P;U++){var q=a[U];if(q._id&&Le(q._id)){R();continue}var C=v.get(q.metadata.id);C.onsuccess=B}}function j(){_||(We.notify(r._meta.name),s(null,u))}function F(x,R){var B=m.get(x);B.onsuccess=function(U){if(U.target.result)R();else{var P=M(mi,"unknown stub attachment with digest "+x);P.status=412,R(P)}}}function z(x){var R=[];if(a.forEach(function(q){q.data&&q.data._attachments&&Object.keys(q.data._attachments).forEach(function(C){var L=q.data._attachments[C];L.stub&&R.push(L.digest)})}),!R.length)return x();var B=0,U;function P(){++B===R.length&&x(U)}R.forEach(function(q){F(q,function(C){C&&!U&&(U=C),P()})})}function Q(x,R,B,U,P,q,C,L){x.metadata.winningRev=R,x.metadata.deleted=B;var $=x.data;$._id=x.metadata.id,$._rev=x.metadata.rev,U&&($._deleted=!0);var K=$._attachments&&Object.keys($._attachments).length;if(K)return b(x,R,B,P,C,L);o+=q,I(),H(x,R,B,P,C,L)}function H(x,R,B,U,P,q){var C=x.data,L=x.metadata;C._doc_id_rev=L.id+"::"+L.rev,delete C._id,delete C._rev;function $(se){var he=x.stemmedRevs||[];U&&r.auto_compaction&&(he=he.concat(Li(x.metadata))),he&&he.length&&Kr(he,x.metadata.id,h),L.seq=se.target.result;var Se=Xt(L,R,B),Y=v.put(Se);Y.onsuccess=Z}function K(se){se.preventDefault(),se.stopPropagation();var he=y.index("_doc_id_rev"),Se=he.getKey(C._doc_id_rev);Se.onsuccess=function(Y){var X=y.put(C,Y.target.result);X.onsuccess=$}}function Z(){u[P]={ok:!0,id:L.id,rev:L.rev},l.set(x.metadata.id,x.metadata),A(x,L.seq,q)}var ne=y.put(C);ne.onsuccess=$,ne.onerror=K}function b(x,R,B,U,P,q){var C=x.data,L=0,$=Object.keys(C._attachments);function K(){L===$.length&&H(x,R,B,U,P,q)}function Z(){L++,K()}$.forEach(function(ne){var se=x.data._attachments[ne];if(se.stub)L++,K();else{var he=se.data;delete se.data,se.revpos=parseInt(R,10);var Se=se.digest;E(Se,he,Z)}})}function A(x,R,B){var U=0,P=Object.keys(x.data._attachments||{});if(!P.length)return B();function q(){++U===P.length&&B()}function C($){var K=x.data._attachments[$].digest,Z=c.put({seq:R,digestSeq:K+"::"+R});Z.onsuccess=q,Z.onerror=function(ne){ne.preventDefault(),ne.stopPropagation(),q()}}for(var L=0;L<P.length;L++)C(P[L])}function E(x,R,B){var U=m.count(x);U.onsuccess=function(P){var q=P.target.result;if(q)return B();var C={digest:x,body:R},L=m.put(C);L.onsuccess=B}}}function Ur(t,e,n,r,i){r===-1&&(r=1e3);var s=typeof t.getAll=="function"&&typeof t.getAllKeys=="function"&&r>1&&!n,a,h,v;function y(w){h=w.target.result,a&&i(a,h,v)}function m(w){a=w.target.result,h&&i(a,h,v)}function c(){if(!a.length)return i();var w=a[a.length-1],S;if(e&&e.upper)try{S=IDBKeyRange.bound(w,e.upper,!0,e.upperOpen)}catch(O){if(O.name==="DataError"&&O.code===0)return i()}else S=IDBKeyRange.lowerBound(w,!0);e=S,a=null,h=null,t.getAll(e,r).onsuccess=y,t.getAllKeys(e,r).onsuccess=m}function g(w){var S=w.target.result;if(!S)return i();i([S.key],[S.value],S)}s?(v={continue:c},t.getAll(e,r).onsuccess=y,t.getAllKeys(e,r).onsuccess=m):n?t.openCursor(e,"prev").onsuccess=g:t.openCursor(e).onsuccess=g}function ta(t,e,n){if(typeof t.getAll=="function"){t.getAll(e).onsuccess=n;return}var r=[];function i(s){var a=s.target.result;a?(r.push(a.value),a.continue()):n({target:{result:r}})}t.openCursor(e).onsuccess=i}function na(t,e,n){var r=new Array(t.length),i=0;t.forEach(function(s,a){e.get(s).onsuccess=function(h){h.target.result?r[a]=h.target.result:r[a]={key:s,error:"not_found"},i++,i===t.length&&n(t,r,{})}})}function ra(t,e,n,r,i){try{if(t&&e)return i?IDBKeyRange.bound(e,t,!n,!1):IDBKeyRange.bound(t,e,!1,!n);if(t)return i?IDBKeyRange.upperBound(t):IDBKeyRange.lowerBound(t);if(e)return i?IDBKeyRange.lowerBound(e,!n):IDBKeyRange.upperBound(e,!n);if(r)return IDBKeyRange.only(r)}catch(s){return{error:s}}return null}function ia(t,e,n){var r="startkey"in t?t.startkey:!1,i="endkey"in t?t.endkey:!1,s="key"in t?t.key:!1,a="keys"in t?t.keys:!1,h=t.skip||0,v=typeof t.limit=="number"?t.limit:-1,y=t.inclusive_end!==!1,m,c;if(!a&&(m=ra(r,i,y,s,t.descending),c=m&&m.error,c&&!(c.name==="DataError"&&c.code===0)))return n(M(fn,c.name,c.message));var g=[ae,le,de];t.attachments&&g.push(ge);var w=be(e,g,"readonly");if(w.error)return n(w.error);var S=w.txn;S.oncomplete=G,S.onabort=Oe(n);var O=S.objectStore(ae),p=S.objectStore(le),d=S.objectStore(de),f=p.index("_doc_id_rev"),o=[],u,l;d.get(de).onsuccess=function(j){u=j.target.result.docCount},t.update_seq&&(p.openKeyCursor(null,"prev").onsuccess=j=>{var F=j.target.result;F&&F.key&&(l=F.key)});function _(j,F,z){var Q=j.id+"::"+z;f.get(Q).onsuccess=function(b){if(F.doc=ht(b.target.result)||{},t.conflicts){var A=wn(j);A.length&&(F.doc._conflicts=A)}Fr(F.doc,t,S)}}function k(j,F){var z={id:F.id,key:F.id,value:{rev:j}},Q=F.deleted;Q?a&&(o.push(z),z.value.deleted=!0,z.doc=null):h--<=0&&(o.push(z),t.include_docs&&_(F,z,j))}function T(j){for(var F=0,z=j.length;F<z&&o.length!==v;F++){var Q=j[F];if(Q.error&&a){o.push(Q);continue}var H=Pe(Q),b=H.winningRev;k(b,H)}}function D(j,F,z){z&&(T(F),o.length<v&&z.continue())}function N(j){var F=j.target.result;t.descending&&(F=F.reverse()),T(F)}function I(){var j={total_rows:u,offset:t.skip,rows:o};t.update_seq&&l!==void 0&&(j.update_seq=l),n(null,j)}function G(){t.attachments?Yt(o,t.binary).then(I):I()}if(!(c||v===0)){if(a)return na(a,O,D);if(v===-1)return ta(O,m,N);Ur(O,m,t.descending,v+h,D)}}function sa(t,e){var n=t.objectStore(ae).index("deletedOrLocal");n.count(IDBKeyRange.only("0")).onsuccess=function(r){e(r.target.result)}}var Zt=!1,Vt=[];function aa(t,e,n,r){try{t(e,n)}catch(i){r.emit("error",i)}}function Vn(){Zt||!Vt.length||(Zt=!0,Vt.shift()())}function oa(t,e,n){Vt.push(function(){t(function(s,a){aa(e,s,a,n),Zt=!1,Ce(function(){Vn(n)})})}),Vn()}function ua(t,e,n,r){if(t=ue(t),t.continuous){var i=n+":"+mt();return We.addListener(n,i,e,t),We.notify(n),{cancel:function(){We.removeListener(n,i)}}}var s=t.doc_ids&&new Set(t.doc_ids);t.since=t.since||0;var a=t.since,h="limit"in t?t.limit:-1;h===0&&(h=1);var v=[],y=0,m=ln(t),c=new Map,g,w,S,O;function p(T,D,N){if(!N||!T.length)return;var I=new Array(T.length),G=new Array(T.length);function j(Q,H){var b=t.processChange(H,Q,t);a=b.seq=Q.seq;var A=m(b);return typeof A=="object"?Promise.reject(A):A?(y++,t.return_docs&&v.push(b),t.attachments&&t.include_docs?new Promise(function(E){Fr(H,t,g,function(){Yt([b],t.binary).then(function(){E(b)})})}):Promise.resolve(b)):Promise.resolve()}function F(){for(var Q=[],H=0,b=I.length;H<b&&y!==h;H++){var A=I[H];if(A){var E=G[H];Q.push(j(E,A))}}Promise.all(Q).then(function(x){for(var R=0,B=x.length;R<B;R++)x[R]&&t.onChange(x[R])}).catch(t.complete),y!==h&&N.continue()}var z=0;D.forEach(function(Q,H){var b=ht(Q),A=T[H];f(b,A,function(E,x){G[H]=E,I[H]=x,++z===T.length&&F()})})}function d(T,D,N,I){if(N.seq!==D)return I();if(N.winningRev===T._rev)return I(N,T);var G=T._id+"::"+N.winningRev,j=O.get(G);j.onsuccess=function(F){I(N,ht(F.target.result))}}function f(T,D,N){if(s&&!s.has(T._id))return N();var I=c.get(T._id);if(I)return d(T,D,I,N);S.get(T._id).onsuccess=function(G){I=Pe(G.target.result),c.set(T._id,I),d(T,D,I,N)}}function o(){t.complete(null,{results:v,last_seq:a})}function u(){!t.continuous&&t.attachments?Yt(v).then(o):o()}var l=[ae,le];t.attachments&&l.push(ge);var _=be(r,l,"readonly");if(_.error)return t.complete(_.error);g=_.txn,g.onabort=Oe(t.complete),g.oncomplete=u,w=g.objectStore(le),S=g.objectStore(ae),O=w.index("_doc_id_rev");var k=t.since&&!t.descending?IDBKeyRange.lowerBound(t.since,!0):null;Ur(w,k,t.descending,h,p)}var Fe=new Map,Tt,Rt=new Map;function Mr(t,e){var n=this;oa(function(r){ca(n,t,r)},e,n.constructor)}function ca(t,e,n){var r=e.name,i=null,s=null;t._meta=null;function a(p){return function(d,f){d&&d instanceof Error&&!d.reason&&s&&(d.reason=s),p(d,f)}}function h(p){var d=p.createObjectStore(ae,{keyPath:"id"});p.createObjectStore(le,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),p.createObjectStore(ge,{keyPath:"digest"}),p.createObjectStore(de,{keyPath:"id",autoIncrement:!1}),p.createObjectStore(kt),d.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),p.createObjectStore(Ae,{keyPath:"_id"});var f=p.createObjectStore(Re,{autoIncrement:!0});f.createIndex("seq","seq"),f.createIndex("digestSeq","digestSeq",{unique:!0})}function v(p,d){var f=p.objectStore(ae);f.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),f.openCursor().onsuccess=function(o){var u=o.target.result;if(u){var l=u.value,_=Ee(l);l.deletedOrLocal=_?"1":"0",f.put(l),u.continue()}else d()}}function y(p){p.createObjectStore(Ae,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function m(p,d){var f=p.objectStore(Ae),o=p.objectStore(ae),u=p.objectStore(le),l=o.openCursor();l.onsuccess=function(_){var k=_.target.result;if(k){var T=k.value,D=T.id,N=Le(D),I=Be(T);if(N){var G=D+"::"+I,j=D+"::",F=D+"::~",z=u.index("_doc_id_rev"),Q=IDBKeyRange.bound(j,F,!1,!1),H=z.openCursor(Q);H.onsuccess=function(b){if(H=b.target.result,!H)o.delete(k.primaryKey),k.continue();else{var A=H.value;A._doc_id_rev===G&&f.put(A),u.delete(H.primaryKey),H.continue()}}}else k.continue()}else d&&d()}}function c(p){var d=p.createObjectStore(Re,{autoIncrement:!0});d.createIndex("seq","seq"),d.createIndex("digestSeq","digestSeq",{unique:!0})}function g(p,d){var f=p.objectStore(le),o=p.objectStore(ge),u=p.objectStore(Re),l=o.count();l.onsuccess=function(_){var k=_.target.result;if(!k)return d();f.openCursor().onsuccess=function(T){var D=T.target.result;if(!D)return d();for(var N=D.value,I=D.primaryKey,G=Object.keys(N._attachments||{}),j={},F=0;F<G.length;F++){var z=N._attachments[G[F]];j[z.digest]=!0}var Q=Object.keys(j);for(F=0;F<Q.length;F++){var H=Q[F];u.put({seq:I,digestSeq:H+"::"+I})}D.continue()}}}function w(p){function d(l){return l.data?Pe(l):(l.deleted=l.deletedOrLocal==="1",l)}var f=p.objectStore(le),o=p.objectStore(ae),u=o.openCursor();u.onsuccess=function(l){var _=l.target.result;if(!_)return;var k=d(_.value);k.winningRev=k.winningRev||Be(k);function T(){var N=k.id+"::",I=k.id+"::\uFFFF",G=f.index("_doc_id_rev").openCursor(IDBKeyRange.bound(N,I)),j=0;G.onsuccess=function(F){var z=F.target.result;if(!z)return k.seq=j,D();var Q=z.primaryKey;Q>j&&(j=Q),z.continue()}}function D(){var N=Xt(k,k.winningRev,k.deleted),I=o.put(N);I.onsuccess=function(){_.continue()}}if(k.seq)return D();T()}}t._remote=!1,t.type=function(){return"idb"},t._id=gr(function(p){p(null,t._meta.instanceId)}),t._bulkDocs=function(d,f,o){ea(e,d,f,t,i,a(o))},t._get=function(d,f,o){var u,l,_,k=f.ctx;if(!k){var T=be(i,[ae,le,ge],"readonly");if(T.error)return o(T.error);k=T.txn}function D(){o(_,{doc:u,metadata:l,ctx:k})}k.objectStore(ae).get(d).onsuccess=function(N){if(l=Pe(N.target.result),!l)return _=M(_e,"missing"),D();var I;if(f.rev)I=f.latest?Mi(f.rev,l):f.rev;else{I=l.winningRev;var G=Ee(l);if(G)return _=M(_e,"deleted"),D()}var j=k.objectStore(le),F=l.id+"::"+I;j.index("_doc_id_rev").get(F).onsuccess=function(z){if(u=z.target.result,u&&(u=ht(u)),!u)return _=M(_e,"missing"),D();D()}}},t._getAttachment=function(p,d,f,o,u){var l;if(o.ctx)l=o.ctx;else{var _=be(i,[ae,le,ge],"readonly");if(_.error)return u(_.error);l=_.txn}var k=f.digest,T=f.content_type;l.objectStore(ge).get(k).onsuccess=function(D){var N=D.target.result.body;$r(N,T,o.binary,function(I){u(null,I)})}},t._info=function(d){var f,o,u=be(i,[de,le],"readonly");if(u.error)return d(u.error);var l=u.txn;l.objectStore(de).get(de).onsuccess=function(_){o=_.target.result.docCount},l.objectStore(le).openKeyCursor(null,"prev").onsuccess=function(_){var k=_.target.result;f=k?k.key:0},l.oncomplete=function(){d(null,{doc_count:o,update_seq:f,idb_attachment_format:t._meta.blobSupport?"binary":"base64"})}},t._allDocs=function(d,f){ia(d,i,a(f))},t._changes=function(d){return ua(d,t,r,i)},t._close=function(p){i.close(),Fe.delete(r),p()},t._getRevisionTree=function(p,d){var f=be(i,[ae],"readonly");if(f.error)return d(f.error);var o=f.txn,u=o.objectStore(ae).get(p);u.onsuccess=function(l){var _=Pe(l.target.result);_?d(null,_.rev_tree):d(M(_e))}},t._doCompaction=function(p,d,f){var o=[ae,le,ge,Re],u=be(i,o,"readwrite");if(u.error)return f(u.error);var l=u.txn,_=l.objectStore(ae);_.get(p).onsuccess=function(k){var T=Pe(k.target.result);Ie(T.rev_tree,function(I,G,j,F,z){var Q=G+"-"+j;d.indexOf(Q)!==-1&&(z.status="missing")}),Kr(d,p,l);var D=T.winningRev,N=T.deleted;l.objectStore(ae).put(Xt(T,D,N))},l.onabort=Oe(f),l.oncomplete=function(){f()}},t._getLocal=function(p,d){var f=be(i,[Ae],"readonly");if(f.error)return d(f.error);var o=f.txn,u=o.objectStore(Ae).get(p);u.onerror=Oe(d),u.onsuccess=function(l){var _=l.target.result;_?(delete _._doc_id_rev,d(null,_)):d(M(_e))}},t._putLocal=function(p,d,f){typeof d=="function"&&(f=d,d={}),delete p._revisions;var o=p._rev,u=p._id;o?p._rev="0-"+(parseInt(o.split("-")[1],10)+1):p._rev="0-1";var l=d.ctx,_;if(!l){var k=be(i,[Ae],"readwrite");if(k.error)return f(k.error);l=k.txn,l.onerror=Oe(f),l.oncomplete=function(){_&&f(null,_)}}var T=l.objectStore(Ae),D;o?(D=T.get(u),D.onsuccess=function(N){var I=N.target.result;if(!I||I._rev!==o)f(M(Me));else{var G=T.put(p);G.onsuccess=function(){_={ok:!0,id:p._id,rev:p._rev},d.ctx&&f(null,_)}}}):(D=T.add(p),D.onerror=function(N){f(M(Me)),N.preventDefault(),N.stopPropagation()},D.onsuccess=function(){_={ok:!0,id:p._id,rev:p._rev},d.ctx&&f(null,_)})},t._removeLocal=function(p,d,f){typeof d=="function"&&(f=d,d={});var o=d.ctx;if(!o){var u=be(i,[Ae],"readwrite");if(u.error)return f(u.error);o=u.txn,o.oncomplete=function(){l&&f(null,l)}}var l,_=p._id,k=o.objectStore(Ae),T=k.get(_);T.onerror=Oe(f),T.onsuccess=function(D){var N=D.target.result;!N||N._rev!==p._rev?f(M(_e)):(k.delete(_),l={ok:!0,id:_,rev:"0-0"},d.ctx&&f(null,l))}},t._destroy=function(p,d){We.removeAllListeners(r);var f=Rt.get(r);f&&f.result&&(f.result.close(),Fe.delete(r));var o=indexedDB.deleteDatabase(r);o.onsuccess=function(){Rt.delete(r),ut()&&r in localStorage&&delete localStorage[r],d(null,{ok:!0})},o.onerror=Oe(d)};var S=Fe.get(r);if(S)return i=S.idb,t._meta=S.global,Ce(function(){n(null,t)});var O=indexedDB.open(r,Ys);Rt.set(r,O),O.onupgradeneeded=function(p){var d=p.target.result;if(p.oldVersion<1)return h(d);var f=p.currentTarget.transaction;p.oldVersion<3&&y(d),p.oldVersion<4&&c(d);var o=[v,m,g,w],u=p.oldVersion;function l(){var _=o[u-1];u++,_&&_(f,l)}l()},O.onsuccess=function(p){i=p.target.result,i.onversionchange=function(){i.close(),Fe.delete(r)},i.onabort=function(D){ye("error","Database has a global failure",D.target.error),s=D.target.error,i.close(),Fe.delete(r)};var d=i.transaction([de,kt,ae],"readwrite"),f=!1,o,u,l,_;function k(){typeof l>"u"||!f||(t._meta={name:r,instanceId:_,blobSupport:l},Fe.set(r,{idb:i,global:t._meta}),n(null,t))}function T(){if(!(typeof u>"u"||typeof o>"u")){var D=r+"_id";D in o?_=o[D]:o[D]=_=mt(),o.docCount=u,d.objectStore(de).put(o)}}d.objectStore(de).get(de).onsuccess=function(D){o=D.target.result||{id:de},T()},sa(d,function(D){u=D,T()}),Tt||(Tt=$s(d,kt,"key")),Tt.then(function(D){l=D,k()}),d.oncomplete=function(){f=!0,k()},d.onabort=Oe(n)},O.onerror=function(p){var d=p.target.error&&p.target.error.message;d?d.indexOf("stored database is a higher version")!==-1&&(d=new Error('This DB was created with the newer "indexeddb" adapter, but you are trying to open it with the older "idb" adapter')):d="Failed to open indexedDB, are you in private browsing mode?",ye("error",d),n(M(fn,d))}}Mr.valid=function(){try{return typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}};function fa(t){t.adapter("idb",Mr,!0)}function la(t,e){return new Promise(function(n,r){var i=0,s=0,a=0,h=t.length,v;function y(){i++,t[s++]().then(c,g)}function m(){++a===h?v?r(v):n():w()}function c(){i--,m()}function g(S){i--,v=v||S,m()}function w(){for(;i<e&&s<h;)y()}w()})}var da=25,ha=50,rt=5e3,va=1e4,Pt={};function Lt(t){let e=t.doc||t.ok,n=e&&e._attachments;n&&Object.keys(n).forEach(function(r){let i=n[r];i.data=gn(i.data,i.content_type)})}function ke(t){return/^_design/.test(t)?"_design/"+encodeURIComponent(t.slice(8)):t.startsWith("_local/")?"_local/"+encodeURIComponent(t.slice(7)):encodeURIComponent(t)}function er(t){return!t._attachments||!Object.keys(t._attachments)?Promise.resolve():Promise.all(Object.keys(t._attachments).map(function(e){let n=t._attachments[e];if(n.data&&typeof n.data!="string")return new Promise(function(r){yn(n.data,r)}).then(function(r){n.data=r})}))}function _a(t){if(!t.prefix)return!1;let e=br(t.prefix).protocol;return e==="http"||e==="https"}function ga(t,e){if(_a(e)){let i=e.name.substr(e.prefix.length);t=e.prefix.replace(/\/?$/,"/")+encodeURIComponent(i)}let n=br(t);(n.user||n.password)&&(n.auth={username:n.user,password:n.password});let r=n.path.replace(/(^\/|\/$)/g,"").split("/");return n.db=r.pop(),n.db.indexOf("%")===-1&&(n.db=encodeURIComponent(n.db)),n.path=r.join("/"),n}function oe(t,e){return at(t,t.db+"/"+e)}function at(t,e){let n=t.path?"/":"";return t.protocol+"://"+t.host+(t.port?":"+t.port:"")+"/"+t.path+n+e}function it(t){let e=Object.keys(t);return e.length===0?"":"?"+e.map(n=>n+"="+encodeURIComponent(t[n])).join("&")}function ya(t){let e=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",n=e.indexOf("msie")!==-1,r=e.indexOf("trident")!==-1,i=e.indexOf("edge")!==-1,s=!("method"in t)||t.method==="GET";return(n||r||i)&&s}function en(t,e){let n=this,r=ga(t.name,t),i=oe(r,"");t=ue(t);let s=function(c,g){return W(this,null,function*(){if(g=g||{},g.headers=g.headers||new Ke,g.credentials="include",t.auth||r.auth){let O=t.auth||r.auth,p=O.username+":"+O.password,d=Ze(unescape(encodeURIComponent(p)));g.headers.set("Authorization","Basic "+d)}let w=t.headers||{};return Object.keys(w).forEach(function(O){g.headers.append(O,w[O])}),ya(g)&&(c+=(c.indexOf("?")===-1?"?":"&")+"_nonce="+Date.now()),yield(t.fetch||Tr)(c,g)})};function a(c,g){return re(c,function(...w){y().then(function(){return g.apply(this,w)}).catch(function(S){w.pop()(S)})}).bind(n)}function h(c,g){return W(this,null,function*(){let w={};g=g||{},g.headers=g.headers||new Ke,g.headers.get("Content-Type")||g.headers.set("Content-Type","application/json"),g.headers.get("Accept")||g.headers.set("Accept","application/json");let S=yield s(c,g);w.ok=S.ok,w.status=S.status;let O=yield S.json();if(w.data=O,!w.ok)throw w.data.status=w.status,Ge(w.data);return Array.isArray(w.data)&&(w.data=w.data.map(function(p){return p.error||p.missing?Ge(p):p})),w})}let v;function y(){return W(this,null,function*(){return t.skip_setup?Promise.resolve():v||(v=h(i).catch(function(c){return c&&c.status&&c.status===404?(Kt(404,"PouchDB is just detecting if the remote exists."),h(i,{method:"PUT"})):Promise.reject(c)}).catch(function(c){return c&&c.status&&c.status===412?!0:Promise.reject(c)}),v.catch(function(){v=null}),v)})}Ce(function(){e(null,n)}),n._remote=!0,n.type=function(){return"http"},n.id=a("id",function(c){return W(this,null,function*(){let g;try{g=yield(yield s(at(r,""))).json()}catch{g={}}let w=g&&g.uuid?g.uuid+r.db:oe(r,"");c(null,w)})}),n.compact=a("compact",function(c,g){return W(this,null,function*(){typeof c=="function"&&(g=c,c={}),c=ue(c),yield h(oe(r,"_compact"),{method:"POST"});function w(){n.info(function(S,O){O&&!O.compact_running?g(null,{ok:!0}):setTimeout(w,c.interval||200)})}w()})}),n.bulkGet=re("bulkGet",function(c,g){let w=this;function S(f){return W(this,null,function*(){let o={};c.revs&&(o.revs=!0),c.attachments&&(o.attachments=!0),c.latest&&(o.latest=!0);try{let u=yield h(oe(r,"_bulk_get"+it(o)),{method:"POST",body:JSON.stringify({docs:c.docs})});c.attachments&&c.binary&&u.data.results.forEach(function(l){l.docs.forEach(Lt)}),f(null,u.data)}catch(u){f(u)}})}function O(){let f=ha,o=Math.ceil(c.docs.length/f),u=0,l=new Array(o);function _(k){return function(T,D){l[k]=D.results,++u===o&&g(null,{results:l.flat()})}}for(let k=0;k<o;k++){let T=Ye(c,["revs","attachments","binary","latest"]);T.docs=c.docs.slice(k*f,Math.min(c.docs.length,(k+1)*f)),yr(w,T,_(k))}}let p=at(r,""),d=Pt[p];typeof d!="boolean"?S(function(f,o){f?(Pt[p]=!1,Kt(f.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),O()):(Pt[p]=!0,g(null,o))}):d?S(g):O()}),n._info=function(c){return W(this,null,function*(){try{yield y();let w=yield(yield s(oe(r,""))).json();w.host=oe(r,""),c(null,w)}catch(g){c(g)}})},n.fetch=function(c,g){return W(this,null,function*(){yield y();let w=c.substring(0,1)==="/"?at(r,c.substring(1)):oe(r,c);return s(w,g)})},n.get=a("get",function(c,g,w){return W(this,null,function*(){typeof g=="function"&&(w=g,g={}),g=ue(g);let S={};g.revs&&(S.revs=!0),g.revs_info&&(S.revs_info=!0),g.latest&&(S.latest=!0),g.open_revs&&(g.open_revs!=="all"&&(g.open_revs=JSON.stringify(g.open_revs)),S.open_revs=g.open_revs),g.rev&&(S.rev=g.rev),g.conflicts&&(S.conflicts=g.conflicts),g.update_seq&&(S.update_seq=g.update_seq),c=ke(c);function O(f){let o=f._attachments,u=o&&Object.keys(o);if(!o||!u.length)return;function l(k){return W(this,null,function*(){let T=o[k],D=ke(f._id)+"/"+m(k)+"?rev="+f._rev,N=yield s(oe(r,D)),I;"buffer"in N?I=yield N.buffer():I=yield N.blob();let G;if(g.binary){let j=Object.getOwnPropertyDescriptor(I.__proto__,"type");(!j||j.set)&&(I.type=T.content_type),G=I}else G=yield new Promise(function(j){yn(I,j)});delete T.stub,delete T.length,T.data=G})}let _=u.map(function(k){return function(){return l(k)}});return la(_,5)}function p(f){return Array.isArray(f)?Promise.all(f.map(function(o){if(o.ok)return O(o.ok)})):O(f)}let d=oe(r,c+it(S));try{let f=yield h(d);g.attachments&&(yield p(f.data)),w(null,f.data)}catch(f){f.docId=c,w(f)}})}),n.remove=a("remove",function(c,g,w,S){return W(this,null,function*(){let O;typeof g=="string"?(O={_id:c,_rev:g},typeof w=="function"&&(S=w,w={})):(O=c,typeof g=="function"?(S=g,w={}):(S=w,w=g));let p=O._rev||w.rev,d=oe(r,ke(O._id))+"?rev="+p;try{let f=yield h(d,{method:"DELETE"});S(null,f.data)}catch(f){S(f)}})});function m(c){return c.split("/").map(encodeURIComponent).join("/")}n.getAttachment=a("getAttachment",function(c,g,w,S){return W(this,null,function*(){typeof w=="function"&&(S=w,w={});let O=w.rev?"?rev="+w.rev:"",p=oe(r,ke(c))+"/"+m(g)+O,d;try{let f=yield s(p,{method:"GET"});if(!f.ok)throw f;d=f.headers.get("content-type");let o;if(typeof process<"u"&&!process.browser&&typeof f.buffer=="function"?o=yield f.buffer():o=yield f.blob(),typeof process<"u"&&!process.browser){let u=Object.getOwnPropertyDescriptor(o.__proto__,"type");(!u||u.set)&&(o.type=d)}S(null,o)}catch(f){S(f)}})}),n.removeAttachment=a("removeAttachment",function(c,g,w,S){return W(this,null,function*(){let O=oe(r,ke(c)+"/"+m(g))+"?rev="+w;try{let p=yield h(O,{method:"DELETE"});S(null,p.data)}catch(p){S(p)}})}),n.putAttachment=a("putAttachment",function(c,g,w,S,O,p){return W(this,null,function*(){typeof O=="function"&&(p=O,O=S,S=w,w=null);let d=ke(c)+"/"+m(g),f=oe(r,d);if(w&&(f+="?rev="+w),typeof S=="string"){let o;try{o=hn(S)}catch{return p(M(mr,"Attachment is not a valid base64 string"))}S=o?_n(o,O):""}try{let o=yield h(f,{headers:new Ke({"Content-Type":O}),method:"PUT",body:S});p(null,o.data)}catch(o){p(o)}})}),n._bulkDocs=function(c,g,w){return W(this,null,function*(){c.new_edits=g.new_edits;try{yield y(),yield Promise.all(c.docs.map(er));let S=yield h(oe(r,"_bulk_docs"),{method:"POST",body:JSON.stringify(c)});w(null,S.data)}catch(S){w(S)}})},n._put=function(c,g,w){return W(this,null,function*(){try{yield y(),yield er(c);let S=yield h(oe(r,ke(c._id)),{method:"PUT",body:JSON.stringify(c)});w(null,S.data)}catch(S){S.docId=c&&c._id,w(S)}})},n.allDocs=a("allDocs",function(c,g){return W(this,null,function*(){typeof c=="function"&&(g=c,c={}),c=ue(c);let w={},S,O="GET";c.conflicts&&(w.conflicts=!0),c.update_seq&&(w.update_seq=!0),c.descending&&(w.descending=!0),c.include_docs&&(w.include_docs=!0),c.attachments&&(w.attachments=!0),c.key&&(w.key=JSON.stringify(c.key)),c.start_key&&(c.startkey=c.start_key),c.startkey&&(w.startkey=JSON.stringify(c.startkey)),c.end_key&&(c.endkey=c.end_key),c.endkey&&(w.endkey=JSON.stringify(c.endkey)),typeof c.inclusive_end<"u"&&(w.inclusive_end=!!c.inclusive_end),typeof c.limit<"u"&&(w.limit=c.limit),typeof c.skip<"u"&&(w.skip=c.skip);let p=it(w);typeof c.keys<"u"&&(O="POST",S={keys:c.keys});try{let d=yield h(oe(r,"_all_docs"+p),{method:O,body:JSON.stringify(S)});c.include_docs&&c.attachments&&c.binary&&d.data.rows.forEach(Lt),g(null,d.data)}catch(d){g(d)}})}),n._changes=function(c){let g="batch_size"in c?c.batch_size:da;c=ue(c),c.continuous&&!("heartbeat"in c)&&(c.heartbeat=va);let w="timeout"in c?c.timeout:30*1e3;"timeout"in c&&c.timeout&&w-c.timeout<rt&&(w=c.timeout+rt),"heartbeat"in c&&c.heartbeat&&w-c.heartbeat<rt&&(w=c.heartbeat+rt);let S={};"timeout"in c&&c.timeout&&(S.timeout=c.timeout);let O=typeof c.limit<"u"?c.limit:!1,p=O;if(c.style&&(S.style=c.style),(c.include_docs||c.filter&&typeof c.filter=="function")&&(S.include_docs=!0),c.attachments&&(S.attachments=!0),c.continuous&&(S.feed="longpoll"),c.seq_interval&&(S.seq_interval=c.seq_interval),c.conflicts&&(S.conflicts=!0),c.descending&&(S.descending=!0),c.update_seq&&(S.update_seq=!0),"heartbeat"in c&&c.heartbeat&&(S.heartbeat=c.heartbeat),c.filter&&typeof c.filter=="string"&&(S.filter=c.filter),c.view&&typeof c.view=="string"&&(S.filter="_view",S.view=c.view),c.query_params&&typeof c.query_params=="object")for(let T in c.query_params)Object.prototype.hasOwnProperty.call(c.query_params,T)&&(S[T]=c.query_params[T]);let d="GET",f;c.doc_ids?(S.filter="_doc_ids",d="POST",f={doc_ids:c.doc_ids}):c.selector&&(S.filter="_selector",d="POST",f={selector:c.selector});let o=new AbortController,u,l=function(T,D){return W(this,null,function*(){if(c.aborted)return;S.since=T,typeof S.since=="object"&&(S.since=JSON.stringify(S.since)),c.descending?O&&(S.limit=p):S.limit=!O||p>g?g:p;let N=oe(r,"_changes"+it(S)),I={signal:o.signal,method:d,body:JSON.stringify(f)};if(u=T,!c.aborted)try{yield y();let G=yield h(N,I);D(null,G.data)}catch(G){D(G)}})},_={results:[]},k=function(T,D){if(c.aborted)return;let N=0;if(D&&D.results){N=D.results.length,_.last_seq=D.last_seq;let G=null,j=null;typeof D.pending=="number"&&(G=D.pending),(typeof _.last_seq=="string"||typeof _.last_seq=="number")&&(j=_.last_seq);let F={};F.query=c.query_params,D.results=D.results.filter(function(z){p--;let Q=ln(c)(z);return Q&&(c.include_docs&&c.attachments&&c.binary&&Lt(z),c.return_docs&&_.results.push(z),c.onChange(z,G,j)),Q})}else if(T){c.aborted=!0,c.complete(T);return}D&&D.last_seq&&(u=D.last_seq);let I=O&&p<=0||D&&N<g||c.descending;c.continuous&&!(O&&p<=0)||!I?Ce(function(){l(u,k)}):c.complete(null,_)};return l(c.since||0,k),{cancel:function(){c.aborted=!0,o.abort()}}},n.revsDiff=a("revsDiff",function(c,g,w){return W(this,null,function*(){typeof g=="function"&&(w=g,g={});try{let S=yield h(oe(r,"_revs_diff"),{method:"POST",body:JSON.stringify(c)});w(null,S.data)}catch(S){w(S)}})}),n._close=function(c){c()},n._destroy=function(c,g){return W(this,null,function*(){try{let w=yield h(oe(r,""),{method:"DELETE"});g(null,w)}catch(w){w.status===404?g(null,{ok:!0}):g(w)}})}}en.valid=function(){return!0};function pa(t){t.adapter("http",en,!1),t.adapter("https",en,!1)}var Te=class t extends Error{constructor(e){super(),this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,t)}catch{}}},vt=class t extends Error{constructor(e){super(),this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,t)}catch{}}},_t=class t extends Error{constructor(e){super(),this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,t)}catch{}}};function Gr(t,e){return e&&t.then(function(n){Ce(function(){e(null,n)})},function(n){Ce(function(){e(n)})}),t}function ma(t){return function(...e){var n=e.pop(),r=t.apply(this,e);return typeof n=="function"&&Gr(r,n),r}}function wa(t,e){return t.then(function(n){return e().then(function(){return n})},function(n){return e().then(function(){throw n})})}function Bt(t,e){return function(){var n=arguments,r=this;return t.add(function(){return e.apply(r,n)})}}function tr(t){var e=new Set(t),n=new Array(e.size),r=-1;return e.forEach(function(i){n[++r]=i}),n}function It(t){var e=new Array(t.size),n=-1;return t.forEach(function(r,i){e[++n]=i}),e}function nr(t){var e="builtin "+t+" function requires map values to be numbers or number arrays";return new _t(e)}function tn(t){for(var e=0,n=0,r=t.length;n<r;n++){var i=t[n];if(typeof i!="number")if(Array.isArray(i)){e=typeof e=="number"?[e]:e;for(var s=0,a=i.length;s<a;s++){var h=i[s];if(typeof h!="number")throw nr("_sum");typeof e[s]>"u"?e.push(h):e[s]+=h}}else throw nr("_sum");else typeof e=="number"?e+=i:e[0]+=i}return e}var ba=ye.bind(null,"log"),Sa=Array.isArray,Aa=JSON.parse;function Jr(t,e){return dn("return ("+t.replace(/;\s*$/,"")+");",{emit:e,sum:tn,log:ba,isArray:Sa,toJSON:Aa})}var Xe=class{constructor(){this.promise=Promise.resolve()}add(e){return this.promise=this.promise.catch(()=>{}).then(()=>e()),this.promise}finish(){return this.promise}};function rr(t){if(!t)return"undefined";switch(typeof t){case"function":return t.toString();case"string":return t.toString();default:return JSON.stringify(t)}}function Oa(t,e){return rr(t)+rr(e)+"undefined"}function ir(t,e,n,r,i,s){return W(this,null,function*(){let a=Oa(n,r),h;if(!i&&(h=t._cachedViews=t._cachedViews||{},h[a]))return h[a];let v=t.info().then(function(y){return W(this,null,function*(){let m=y.db_name+"-mrview-"+(i?"temp":Or(a));function c(p){p.views=p.views||{};let d=e;d.indexOf("/")===-1&&(d=e+"/"+e);let f=p.views[d]=p.views[d]||{};if(!f[m])return f[m]=!0,p}yield ct(t,"_local/"+s,c);let w=(yield t.registerDependentDatabase(m)).db;w.auto_compaction=!0;let S={name:m,db:w,sourceDB:t,adapter:t.adapter,mapFun:n,reduceFun:r},O;try{O=yield S.db.get("_local/lastSeq")}catch(p){if(p.status!==404)throw p}return S.seq=O?O.seq:0,h&&S.db.once("destroyed",function(){delete h[a]}),S})});return h&&(h[a]=v),v})}var sr={},ar=new Xe,qa=50;function jt(t){return t.indexOf("/")===-1?[t,t]:t.split("/")}function xa(t){return t.length===1&&/^1-/.test(t[0].rev)}function or(t,e,n){try{t.emit("error",e)}catch{ye("error",`The user's map/reduce function threw an uncaught error.
You can debug this error by doing:
myDatabase.on('error', function (err) { debugger; });
Please double-check your map/reduce function.`),ye("error",e,n)}}function Ca(t,e,n,r){function i(b,A,E){try{A(E)}catch(x){or(b,x,{fun:A,doc:E})}}function s(b,A,E,x,R){try{return{output:A(E,x,R)}}catch(B){return or(b,B,{fun:A,keys:E,values:x,rereduce:R}),{error:B}}}function a(b,A){let E=ie(b.key,A.key);return E!==0?E:ie(b.value,A.value)}function h(b,A,E){return E=E||0,typeof A=="number"?b.slice(E,A+E):E>0?b.slice(E):b}function v(b){let A=b.value;return A&&typeof A=="object"&&A._id||b.id}function y(b){for(let A of b.rows){let E=A.doc&&A.doc._attachments;if(E)for(let x of Object.keys(E)){let R=E[x];E[x].data=gn(R.data,R.content_type)}}}function m(b){return function(A){return b.include_docs&&b.attachments&&b.binary&&y(A),A}}function c(b,A,E,x){let R=A[b];typeof R<"u"&&(x&&(R=encodeURIComponent(JSON.stringify(R))),E.push(b+"="+R))}function g(b){if(typeof b<"u"){let A=Number(b);return!isNaN(A)&&A===parseInt(b,10)?A:b}}function w(b){return b.group_level=g(b.group_level),b.limit=g(b.limit),b.skip=g(b.skip),b}function S(b){if(b){if(typeof b!="number")return new Te(`Invalid value for integer: "${b}"`);if(b<0)return new Te(`Invalid value for positive integer: "${b}"`)}}function O(b,A){let E=b.descending?"endkey":"startkey",x=b.descending?"startkey":"endkey";if(typeof b[E]<"u"&&typeof b[x]<"u"&&ie(b[E],b[x])>0)throw new Te("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(A.reduce&&b.reduce!==!1){if(b.include_docs)throw new Te("{include_docs:true} is invalid for reduce");if(b.keys&&b.keys.length>1&&!b.group&&!b.group_level)throw new Te("Multi-key fetches for reduce views must use {group: true}")}for(let R of["group_level","limit","skip"]){let B=S(b[R]);if(B)throw B}}function p(b,A,E){return W(this,null,function*(){let x=[],R,B="GET",U;if(c("reduce",E,x),c("include_docs",E,x),c("attachments",E,x),c("limit",E,x),c("descending",E,x),c("group",E,x),c("group_level",E,x),c("skip",E,x),c("stale",E,x),c("conflicts",E,x),c("startkey",E,x,!0),c("start_key",E,x,!0),c("endkey",E,x,!0),c("end_key",E,x,!0),c("inclusive_end",E,x),c("key",E,x,!0),c("update_seq",E,x),x=x.join("&"),x=x===""?"":"?"+x,typeof E.keys<"u"){let L=`keys=${encodeURIComponent(JSON.stringify(E.keys))}`;L.length+x.length+1<=2e3?x+=(x[0]==="?"?"&":"?")+L:(B="POST",typeof A=="string"?R={keys:E.keys}:A.keys=E.keys)}if(typeof A=="string"){let C=jt(A),L=yield b.fetch("_design/"+C[0]+"/_view/"+C[1]+x,{headers:new Ke({"Content-Type":"application/json"}),method:B,body:JSON.stringify(R)});U=L.ok;let $=yield L.json();if(!U)throw $.status=L.status,Ge($);for(let K of $.rows)if(K.value&&K.value.error&&K.value.error==="builtin_reduce_error")throw new Error(K.reason);return new Promise(function(K){K($)}).then(m(E))}R=R||{};for(let C of Object.keys(A))Array.isArray(A[C])?R[C]=A[C]:R[C]=A[C].toString();let P=yield b.fetch("_temp_view"+x,{headers:new Ke({"Content-Type":"application/json"}),method:"POST",body:JSON.stringify(R)});U=P.ok;let q=yield P.json();if(!U)throw q.status=P.status,Ge(q);return new Promise(function(C){C(q)}).then(m(E))})}function d(b,A,E){return new Promise(function(x,R){b._query(A,E,function(B,U){if(B)return R(B);x(U)})})}function f(b){return new Promise(function(A,E){b._viewCleanup(function(x,R){if(x)return E(x);A(R)})})}function o(b){return function(A){if(A.status===404)return b;throw A}}function u(b,A,E){return W(this,null,function*(){let x="_local/doc_"+b,R={_id:x,keys:[]},B=E.get(b),U=B[0],P=B[1];function q(){return xa(P)?Promise.resolve(R):A.db.get(x).catch(o(R))}function C(Z){return Z.keys.length?A.db.allDocs({keys:Z.keys,include_docs:!0}):Promise.resolve({rows:[]})}function L(Z,ne){let se=[],he=new Set;for(let Y of ne.rows){let X=Y.doc;if(X&&(se.push(X),he.add(X._id),X._deleted=!U.has(X._id),!X._deleted)){let V=U.get(X._id);"value"in V&&(X.value=V.value)}}let Se=It(U);for(let Y of Se)if(!he.has(Y)){let X={_id:Y},V=U.get(Y);"value"in V&&(X.value=V.value),se.push(X)}return Z.keys=tr(Se.concat(Z.keys)),se.push(Z),se}let $=yield q(),K=yield C($);return L($,K)})}function l(b){return b.sourceDB.get("_local/purges").then(function(A){let E=A.purgeSeq;return b.db.get("_local/purgeSeq").then(function(x){return x._rev}).catch(o(void 0)).then(function(x){return b.db.put({_id:"_local/purgeSeq",_rev:x,purgeSeq:E})})}).catch(function(A){if(A.status!==404)throw A})}function _(b,A,E){var x="_local/lastSeq";return b.db.get(x).catch(o({_id:x,seq:0})).then(function(R){var B=It(A);return Promise.all(B.map(function(U){return u(U,b,A)})).then(function(U){var P=U.flat();return R.seq=E,P.push(R),b.db.bulkDocs({docs:P})}).then(()=>l(b))})}function k(b){let A=typeof b=="string"?b:b.name,E=sr[A];return E||(E=sr[A]=new Xe),E}function T(b,A){return W(this,null,function*(){return Bt(k(b),function(){return D(b,A)})()})}function D(b,A){return W(this,null,function*(){let E,x,R;function B(Y,X){let V={id:x._id,key:je(Y)};typeof X<"u"&&X!==null&&(V.value=je(X)),E.push(V)}let U=e(b.mapFun,B),P=b.seq||0;function q(){return b.sourceDB.info().then(function(Y){R=b.sourceDB.activeTasks.add({name:"view_indexing",total_items:Y.update_seq-P})})}function C(Y,X){return function(){return _(b,Y,X)}}let L=0,$={view:b.name,indexed_docs:L};b.sourceDB.emit("indexing",$);let K=new Xe;function Z(){return W(this,null,function*(){let Y=yield b.sourceDB.changes({return_docs:!0,conflicts:!0,include_docs:!0,style:"all_docs",since:P,limit:A.changes_batch_size}),X=yield ne();return se(Y,X)})}function ne(){return b.db.get("_local/purgeSeq").then(function(Y){return Y.purgeSeq}).catch(o(-1)).then(function(Y){return b.sourceDB.get("_local/purges").then(function(X){let V=X.purges.filter(function(ve,ce){return ce>Y}).map(ve=>ve.docId),pe=V.filter(function(ve,ce){return V.indexOf(ve)===ce});return Promise.all(pe.map(function(ve){return b.sourceDB.get(ve).then(function(ce){return{docId:ve,doc:ce}}).catch(o({docId:ve}))}))}).catch(o([]))})}function se(Y,X){let V=Y.results;if(!V.length&&!X.length)return;for(let ce of X)if(V.findIndex(function(Je){return Je.id===ce.docId})<0){let Je={_id:ce.docId,doc:{_id:ce.docId,_deleted:1},changes:[]};ce.doc&&(Je.doc=ce.doc,Je.changes.push({rev:ce.doc._rev})),V.push(Je)}let pe=he(V);K.add(C(pe,P)),L=L+V.length;let ve={view:b.name,last_seq:Y.last_seq,results_count:V.length,indexed_docs:L};if(b.sourceDB.emit("indexing",ve),b.sourceDB.activeTasks.update(R,{completed_items:L}),!(V.length<A.changes_batch_size))return Z()}function he(Y){let X=new Map;for(let V of Y){if(V.doc._id[0]!=="_"){E=[],x=V.doc,x._deleted||i(b.sourceDB,U,x),E.sort(a);let pe=Se(E);X.set(V.doc._id,[pe,V.changes])}P=V.seq}return X}function Se(Y){let X=new Map,V;for(let pe=0,ve=Y.length;pe<ve;pe++){let ce=Y[pe],wt=[ce.key,ce.id];pe>0&&ie(ce.key,V)===0&&wt.push(pe),X.set(we(wt),ce),V=ce.key}return X}try{yield q(),yield Z(),yield K.finish(),b.seq=P,b.sourceDB.activeTasks.remove(R)}catch(Y){b.sourceDB.activeTasks.remove(R,Y)}})}function N(b,A,E){E.group_level===0&&delete E.group_level;let x=E.group||E.group_level,R=n(b.reduceFun),B=[],U=isNaN(E.group_level)?Number.POSITIVE_INFINITY:E.group_level;for(let P of A){let q=B[B.length-1],C=x?P.key:null;if(x&&Array.isArray(C)&&(C=C.slice(0,U)),q&&ie(q.groupKey,C)===0){q.keys.push([P.key,P.id]),q.values.push(P.value);continue}B.push({keys:[[P.key,P.id]],values:[P.value],groupKey:C})}A=[];for(let P of B){let q=s(b.sourceDB,R,P.keys,P.values,!1);if(q.error&&q.error instanceof _t)throw q.error;A.push({value:q.error?null:q.output,key:P.groupKey})}return{rows:h(A,E.limit,E.skip)}}function I(b,A){return Bt(k(b),function(){return G(b,A)})()}function G(b,A){return W(this,null,function*(){let E,x=b.reduceFun&&A.reduce!==!1,R=A.skip||0;typeof A.keys<"u"&&!A.keys.length&&(A.limit=0,delete A.keys);function B(P){return W(this,null,function*(){P.include_docs=!0;let q=yield b.db.allDocs(P);return E=q.total_rows,q.rows.map(function(C){if("value"in C.doc&&typeof C.doc.value=="object"&&C.doc.value!==null){let $=Object.keys(C.doc.value).sort(),K=["id","key","value"];if(!($<K||$>K))return C.doc.value}let L=ps(C.doc._id);return{key:L[0],id:L[1],value:"value"in C.doc?C.doc.value:null}})})}function U(P){return W(this,null,function*(){let q;if(x?q=N(b,P,A):typeof A.keys>"u"?q={total_rows:E,offset:R,rows:P}:q={total_rows:E,offset:R,rows:h(P,A.limit,A.skip)},A.update_seq&&(q.update_seq=b.seq),A.include_docs){let C=tr(P.map(v)),L=yield b.sourceDB.allDocs({keys:C,include_docs:!0,conflicts:A.conflicts,attachments:A.attachments,binary:A.binary}),$=new Map;for(let K of L.rows)$.set(K.id,K.doc);for(let K of P){let Z=v(K),ne=$.get(Z);ne&&(K.doc=ne)}}return q})}if(typeof A.keys<"u"){let q=A.keys.map(function($){let K={startkey:we([$]),endkey:we([$,{}])};return A.update_seq&&(K.update_seq=!0),B(K)}),L=(yield Promise.all(q)).flat();return U(L)}else{let P={descending:A.descending};A.update_seq&&(P.update_seq=!0);let q,C;if("start_key"in A&&(q=A.start_key),"startkey"in A&&(q=A.startkey),"end_key"in A&&(C=A.end_key),"endkey"in A&&(C=A.endkey),typeof q<"u"&&(P.startkey=A.descending?we([q,{}]):we([q])),typeof C<"u"){let $=A.inclusive_end!==!1;A.descending&&($=!$),P.endkey=we($?[C,{}]:[C])}if(typeof A.key<"u"){let $=we([A.key]),K=we([A.key,{}]);P.descending?(P.endkey=$,P.startkey=K):(P.startkey=$,P.endkey=K)}x||(typeof A.limit=="number"&&(P.limit=A.limit),P.skip=R);let L=yield B(P);return U(L)}})}function j(b){return W(this,null,function*(){return(yield b.fetch("_view_cleanup",{headers:new Ke({"Content-Type":"application/json"}),method:"POST"})).json()})}function F(b){return W(this,null,function*(){try{let A=yield b.get("_local/"+t),E=new Map;for(let q of Object.keys(A.views)){let C=jt(q),L="_design/"+C[0],$=C[1],K=E.get(L);K||(K=new Set,E.set(L,K)),K.add($)}let x={keys:It(E),include_docs:!0},R=yield b.allDocs(x),B={};for(let q of R.rows){let C=q.key.substring(8);for(let L of E.get(q.key)){let $=C+"/"+L;A.views[$]||($=L);let K=Object.keys(A.views[$]),Z=q.doc&&q.doc.views&&q.doc.views[L];for(let ne of K)B[ne]=B[ne]||Z}}let P=Object.keys(B).filter(function(q){return!B[q]}).map(function(q){return Bt(k(q),function(){return new b.constructor(q,b.__opts).destroy()})()});return Promise.all(P).then(function(){return{ok:!0}})}catch(A){if(A.status===404)return{ok:!0};throw A}})}function z(b,A,E){return W(this,null,function*(){if(typeof b._query=="function")return d(b,A,E);if(qe(b))return p(b,A,E);let x={changes_batch_size:b.__opts.view_update_changes_batch_size||qa};if(typeof A!="string")return O(E,A),ar.add(function(){return W(this,null,function*(){let R=yield ir(b,"temp_view/temp_view",A.map,A.reduce,!0,t);return wa(T(R,x).then(function(){return I(R,E)}),function(){return R.db.destroy()})})}),ar.finish();{let R=A,B=jt(R),U=B[0],P=B[1],q=yield b.get("_design/"+U);if(A=q.views&&q.views[P],!A)throw new vt(`ddoc ${q._id} has no view named ${P}`);r(q,P),O(E,A);let C=yield ir(b,R,A.map,A.reduce,!1,t);return E.stale==="ok"||E.stale==="update_after"?(E.stale==="update_after"&&Ce(function(){T(C,x)}),I(C,E)):(yield T(C,x),I(C,E))}})}function Q(b,A,E){let x=this;typeof A=="function"&&(E=A,A={}),A=A?w(A):{},typeof b=="function"&&(b={map:b});let R=Promise.resolve().then(function(){return z(x,b,A)});return Gr(R,E),R}let H=ma(function(){let b=this;return typeof b._viewCleanup=="function"?f(b):qe(b)?j(b):F(b)});return{query:Q,viewCleanup:H}}var Nt={_sum:function(t,e){return tn(e)},_count:function(t,e){return e.length},_stats:function(t,e){function n(r){for(var i=0,s=0,a=r.length;s<a;s++){var h=r[s];i+=h*h}return i}return{sum:tn(e),min:Math.min.apply(null,e),max:Math.max.apply(null,e),count:e.length,sumsqr:n(e)}}};function Ea(t){if(/^_sum/.test(t))return Nt._sum;if(/^_count/.test(t))return Nt._count;if(/^_stats/.test(t))return Nt._stats;if(/^_/.test(t))throw new Error(t+" is not a supported reduce function.")}function Da(t,e){if(typeof t=="function"&&t.length===2){var n=t;return function(r){return n(r,e)}}else return Jr(t.toString(),e)}function ka(t){var e=t.toString(),n=Ea(e);return n||Jr(e)}function Ta(t,e){var n=t.views&&t.views[e];if(typeof n.map!="string")throw new vt("ddoc "+t._id+" has no string view named "+e+", instead found object of type: "+typeof n.map)}var Ra="mrviews",zr=Ca(Ra,Da,ka,Ta);function Pa(t,e,n){return zr.query.call(this,t,e,n)}function La(t){return zr.viewCleanup.call(this,t)}var Ba={query:Pa,viewCleanup:La};function Ia(t,e,n){return!t._attachments||!t._attachments[n]||t._attachments[n].digest!==e._attachments[n].digest}function ur(t,e){var n=Object.keys(e._attachments);return Promise.all(n.map(function(r){return t.getAttachment(e._id,r,{rev:e._rev})}))}function ja(t,e,n){var r=qe(e)&&!qe(t),i=Object.keys(n._attachments);return r?t.get(n._id).then(function(s){return Promise.all(i.map(function(a){return Ia(s,n,a)?e.getAttachment(n._id,a):t.getAttachment(s._id,a)}))}).catch(function(s){if(s.status!==404)throw s;return ur(e,n)}):ur(e,n)}function Na(t){var e=[];return Object.keys(t).forEach(function(n){var r=t[n].missing;r.forEach(function(i){e.push({id:n,rev:i})})}),{docs:e,revs:!0,latest:!0}}function $a(t,e,n,r){n=ue(n);var i=[],s=!0;function a(){var v=Na(n);if(v.docs.length)return t.bulkGet(v).then(function(y){if(r.cancelled)throw new Error("cancelled");return Promise.all(y.results.map(function(m){return Promise.all(m.docs.map(function(c){var g=c.ok;return c.error&&(s=!1),!g||!g._attachments?g:ja(e,t,g).then(w=>{var S=Object.keys(g._attachments);return w.forEach(function(O,p){var d=g._attachments[S[p]];delete d.stub,delete d.length,d.data=O}),g})}))})).then(function(m){i=i.concat(m.flat().filter(Boolean))})})}function h(){return{ok:s,docs:i}}return Promise.resolve().then(a).then(h)}var cr=1,fr="pouchdb",Fa=5,me=0;function nn(t,e,n,r,i){return t.get(e).catch(function(s){if(s.status===404)return(t.adapter==="http"||t.adapter==="https")&&Kt(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:e,history:[],replicator:fr,version:cr};throw s}).then(function(s){if(!i.cancelled&&s.last_seq!==n)return s.history=(s.history||[]).filter(function(a){return a.session_id!==r}),s.history.unshift({last_seq:n,session_id:r}),s.history=s.history.slice(0,Fa),s.version=cr,s.replicator=fr,s.session_id=r,s.last_seq=n,t.put(s).catch(function(a){if(a.status===409)return nn(t,e,n,r,i);throw a})})}var gt=class{constructor(e,n,r,i,s={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0}){this.src=e,this.target=n,this.id=r,this.returnValue=i,this.opts=s,typeof s.writeSourceCheckpoint>"u"&&(s.writeSourceCheckpoint=!0),typeof s.writeTargetCheckpoint>"u"&&(s.writeTargetCheckpoint=!0)}writeCheckpoint(e,n){var r=this;return this.updateTarget(e,n).then(function(){return r.updateSource(e,n)})}updateTarget(e,n){return this.opts.writeTargetCheckpoint?nn(this.target,this.id,e,n,this.returnValue):Promise.resolve(!0)}updateSource(e,n){if(this.opts.writeSourceCheckpoint){var r=this;return nn(this.src,this.id,e,n,this.returnValue).catch(function(i){if(dr(i))return r.opts.writeSourceCheckpoint=!1,!0;throw i})}else return Promise.resolve(!0)}getCheckpoint(){var e=this;return!e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint?Promise.resolve(me):e.opts&&e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint?e.src.get(e.id).then(function(n){return n.last_seq||me}).catch(function(n){if(n.status!==404)throw n;return me}):e.target.get(e.id).then(function(n){return e.opts&&e.opts.writeTargetCheckpoint&&!e.opts.writeSourceCheckpoint?n.last_seq||me:e.src.get(e.id).then(function(r){if(n.version!==r.version)return me;var i;return n.version?i=n.version.toString():i="undefined",i in lr?lr[i](n,r):me},function(r){if(r.status===404&&n.last_seq)return e.src.put({_id:e.id,last_seq:me}).then(function(){return me},function(i){return dr(i)?(e.opts.writeSourceCheckpoint=!1,n.last_seq):me});throw r})}).catch(function(n){if(n.status!==404)throw n;return me})}},lr={undefined:function(t,e){return ie(t.last_seq,e.last_seq)===0?e.last_seq:0},1:function(t,e){return Ka(e,t).last_seq}};function Ka(t,e){return t.session_id===e.session_id?{last_seq:t.last_seq,history:t.history}:Qr(t.history,e.history)}function Qr(t,e){var n=t[0],r=t.slice(1),i=e[0],s=e.slice(1);if(!n||e.length===0)return{last_seq:me,history:[]};var a=n.session_id;if(rn(a,e))return{last_seq:n.last_seq,history:t};var h=i.session_id;return rn(h,r)?{last_seq:i.last_seq,history:s}:Qr(r,s)}function rn(t,e){var n=e[0],r=e.slice(1);return!t||e.length===0?!1:t===n.session_id?!0:rn(t,r)}function dr(t){return typeof t.status=="number"&&Math.floor(t.status/100)===4}function Wr(t,e,n,r,i){return this instanceof gt?Wr:new gt(t,e,n,r,i)}var hr=0;function Ua(t,e,n,r){if(t.retry===!1){e.emit("error",n),e.removeAllListeners();return}if(typeof t.back_off_function!="function"&&(t.back_off_function=vi),e.emit("requestError",n),e.state==="active"||e.state==="pending"){e.emit("paused",n),e.state="stopped";var i=function(){t.current_back_off=hr},s=function(){e.removeListener("active",i)};e.once("paused",s),e.once("active",i)}t.current_back_off=t.current_back_off||hr,t.current_back_off=t.back_off_function(t.current_back_off),setTimeout(r,t.current_back_off)}function Ma(t){return Object.keys(t).sort(ie).reduce(function(e,n){return e[n]=t[n],e},{})}function Ga(t,e,n){var r=n.doc_ids?n.doc_ids.sort(ie):"",i=n.filter?n.filter.toString():"",s="",a="",h="";return n.selector&&(h=JSON.stringify(n.selector)),n.filter&&n.query_params&&(s=JSON.stringify(Ma(n.query_params))),n.filter&&n.filter==="_view"&&(a=n.view.toString()),Promise.all([t.id(),e.id()]).then(function(v){var y=v[0]+v[1]+i+a+s+r+h;return new Promise(function(m){pn(y,m)})}).then(function(v){return v=v.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+v})}function Hr(t,e,n,r,i){var s=[],a,h={seq:0,changes:[],docs:[]},v=!1,y=!1,m=!1,c=0,g=0,w=n.continuous||n.live||!1,S=n.batch_size||100,O=n.batches_limit||10,p=n.style||"all_docs",d=!1,f=n.doc_ids,o=n.selector,u,l,_=[],k=mt(),T;i=i||{ok:!0,start_time:new Date().toISOString(),docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var D={};r.ready(t,e);function N(){return l?Promise.resolve():Ga(t,e,n).then(function(q){u=q;var C={};n.checkpoint===!1?C={writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:n.checkpoint==="source"?C={writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:n.checkpoint==="target"?C={writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:C={writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},l=new Wr(t,e,u,r,C)})}function I(){if(_=[],a.docs.length!==0){var q=a.docs,C={timeout:n.timeout};return e.bulkDocs({docs:q,new_edits:!1},C).then(function(L){if(r.cancelled)throw b(),new Error("cancelled");var $=Object.create(null);L.forEach(function(Z){Z.error&&($[Z.id]=Z)});var K=Object.keys($).length;i.doc_write_failures+=K,i.docs_written+=q.length-K,q.forEach(function(Z){var ne=$[Z._id];if(ne){i.errors.push(ne);var se=(ne.name||"").toLowerCase();if(se==="unauthorized"||se==="forbidden")r.emit("denied",ue(ne));else throw ne}else _.push(Z)})},function(L){throw i.doc_write_failures+=q.length,L})}}function G(){if(a.error)throw new Error("There was a problem getting docs.");i.last_seq=g=a.seq;var q=ue(i);return _.length&&(q.docs=_,typeof a.pending=="number"&&(q.pending=a.pending,delete a.pending),r.emit("change",q)),v=!0,t.info().then(function(C){var L=t.activeTasks.get(T);if(!(!a||!L)){var $=L.completed_items||0,K=parseInt(C.update_seq,10)-parseInt(c,10);t.activeTasks.update(T,{completed_items:$+a.changes.length,total_items:K})}}),l.writeCheckpoint(a.seq,k).then(function(){if(r.emit("checkpoint",{checkpoint:a.seq}),v=!1,r.cancelled)throw b(),new Error("cancelled");a=void 0,R()}).catch(function(C){throw P(C),C})}function j(){var q={};return a.changes.forEach(function(C){r.emit("checkpoint",{revs_diff:C}),C.id!=="_user/"&&(q[C.id]=C.changes.map(function(L){return L.rev}))}),e.revsDiff(q).then(function(C){if(r.cancelled)throw b(),new Error("cancelled");a.diffs=C})}function F(){return $a(t,e,a.diffs,r).then(function(q){a.error=!q.ok,q.docs.forEach(function(C){delete a.diffs[C._id],i.docs_read++,a.docs.push(C)})})}function z(){if(!(r.cancelled||a)){if(s.length===0){Q(!0);return}a=s.shift(),r.emit("checkpoint",{start_next_batch:a.seq}),j().then(F).then(I).then(G).then(z).catch(function(q){H("batch processing terminated with error",q)})}}function Q(q){if(h.changes.length===0){s.length===0&&!a&&((w&&D.live||y)&&(r.state="pending",r.emit("paused")),y&&b());return}(q||y||h.changes.length>=S)&&(s.push(h),h={seq:0,changes:[],docs:[]},(r.state==="pending"||r.state==="stopped")&&(r.state="active",r.emit("active")),z())}function H(q,C){m||(C.message||(C.message=q),i.ok=!1,i.status="aborting",s=[],h={seq:0,changes:[],docs:[]},b(C))}function b(q){if(!m&&!(r.cancelled&&(i.status="cancelled",v)))if(i.status=i.status||"complete",i.end_time=new Date().toISOString(),i.last_seq=g,m=!0,t.activeTasks.remove(T,q),q){q=M(q),q.result=i;var C=(q.name||"").toLowerCase();C==="unauthorized"||C==="forbidden"?(r.emit("error",q),r.removeAllListeners()):Ua(n,r,q,function(){Hr(t,e,n,r)})}else r.emit("complete",i),r.removeAllListeners()}function A(q,C,L){if(r.cancelled)return b();typeof C=="number"&&(h.pending=C);var $=ln(n)(q);if(!$){var K=t.activeTasks.get(T);if(K){var Z=K.completed_items||0;t.activeTasks.update(T,{completed_items:++Z})}return}h.seq=q.seq||L,h.changes.push(q),r.emit("checkpoint",{pending_batch:h.seq}),Ce(function(){Q(s.length===0&&D.live)})}function E(q){if(d=!1,r.cancelled)return b();if(q.results.length>0)D.since=q.results[q.results.length-1].seq,R(),Q(!0);else{var C=function(){w?(D.live=!0,R()):y=!0,Q(!0)};!a&&q.results.length===0?(v=!0,l.writeCheckpoint(q.last_seq,k).then(function(){if(v=!1,i.last_seq=g=q.last_seq,r.cancelled)throw b(),new Error("cancelled");C()}).catch(P)):C()}}function x(q){if(d=!1,r.cancelled)return b();H("changes rejected",q)}function R(){if(!(!d&&!y&&s.length<O))return;d=!0;function q(){L.cancel()}function C(){r.removeListener("cancel",q)}r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",q);var L=t.changes(D).on("change",A);L.then(C,C),L.then(E).catch(x),n.retry&&(r._changes=L,r._abortChanges=q)}function B(q){return t.info().then(function(C){var L=typeof n.since>"u"?parseInt(C.update_seq,10)-parseInt(q,10):parseInt(C.update_seq,10);return T=t.activeTasks.add({name:`${w?"continuous ":""}replication from ${C.db_name}`,total_items:L}),q})}function U(){N().then(function(){if(r.cancelled){b();return}return l.getCheckpoint().then(B).then(function(q){g=q,c=q,D={since:g,limit:S,batch_size:S,style:p,doc_ids:f,selector:o,return_docs:!0},n.filter&&(typeof n.filter!="string"?D.include_docs=!0:D.filter=n.filter),"heartbeat"in n&&(D.heartbeat=n.heartbeat),"timeout"in n&&(D.timeout=n.timeout),n.query_params&&(D.query_params=n.query_params),n.view&&(D.view=n.view),R()})}).catch(function(q){H("getCheckpoint rejected with ",q)})}function P(q){v=!1,H("writeCheckpoint completed with error",q)}if(r.cancelled){b();return}r._addedListeners||(r.once("cancel",b),typeof n.complete=="function"&&(r.once("error",n.complete),r.once("complete",function(q){n.complete(null,q)})),r._addedListeners=!0),typeof n.since>"u"?U():N().then(function(){return v=!0,l.writeCheckpoint(n.since,k)}).then(function(){if(v=!1,r.cancelled){b();return}g=n.since,U()}).catch(P)}var sn=class extends xe.default{constructor(){super(),this.cancelled=!1,this.state="pending";let e=new Promise((n,r)=>{this.once("complete",n),this.once("error",r)});this.then=function(n,r){return e.then(n,r)},this.catch=function(n){return e.catch(n)},this.catch(function(){})}cancel(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")}ready(e,n){if(this._readyCalled)return;this._readyCalled=!0;let r=()=>{this.cancel()};e.once("destroyed",r),n.once("destroyed",r);function i(){e.removeListener("destroyed",r),n.removeListener("destroyed",r)}this.once("complete",i),this.once("error",i)}};function yt(t,e){var n=e.PouchConstructor;return typeof t=="string"?new n(t,e):t}function an(t,e,n,r){if(typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw M(pt,"`doc_ids` filter parameter is not a list.");n.complete=r,n=ue(n),n.continuous=n.continuous||n.live,n.retry="retry"in n?n.retry:!1,n.PouchConstructor=n.PouchConstructor||this;var i=new sn(n),s=yt(t,n),a=yt(e,n);return Hr(s,a,n,i),i}function Ja(t,e,n,r){return typeof n=="function"&&(r=n,n={}),typeof n>"u"&&(n={}),n=ue(n),n.PouchConstructor=n.PouchConstructor||this,t=yt(t,n),e=yt(e,n),new on(t,e,n,r)}var on=class extends xe.default{constructor(e,n,r,i){super(),this.canceled=!1;let s=r.push?Object.assign({},r,r.push):r,a=r.pull?Object.assign({},r,r.pull):r;this.push=an(e,n,s),this.pull=an(n,e,a),this.pushPaused=!0,this.pullPaused=!0;let h=o=>{this.emit("change",{direction:"pull",change:o})},v=o=>{this.emit("change",{direction:"push",change:o})},y=o=>{this.emit("denied",{direction:"push",doc:o})},m=o=>{this.emit("denied",{direction:"pull",doc:o})},c=()=>{this.pushPaused=!0,this.pullPaused&&this.emit("paused")},g=()=>{this.pullPaused=!0,this.pushPaused&&this.emit("paused")},w=()=>{this.pushPaused=!1,this.pullPaused&&this.emit("active",{direction:"push"})},S=()=>{this.pullPaused=!1,this.pushPaused&&this.emit("active",{direction:"pull"})},O={},p=o=>(u,l)=>{(u==="change"&&(l===h||l===v)||u==="denied"&&(l===m||l===y)||u==="paused"&&(l===g||l===c)||u==="active"&&(l===S||l===w))&&(u in O||(O[u]={}),O[u][o]=!0,Object.keys(O[u]).length===2&&this.removeAllListeners(u))};r.live&&(this.push.on("complete",this.pull.cancel.bind(this.pull)),this.pull.on("complete",this.push.cancel.bind(this.push)));function d(o,u,l){o.listeners(u).indexOf(l)==-1&&o.on(u,l)}this.on("newListener",function(o){o==="change"?(d(this.pull,"change",h),d(this.push,"change",v)):o==="denied"?(d(this.pull,"denied",m),d(this.push,"denied",y)):o==="active"?(d(this.pull,"active",S),d(this.push,"active",w)):o==="paused"&&(d(this.pull,"paused",g),d(this.push,"paused",c))}),this.on("removeListener",function(o){o==="change"?(this.pull.removeListener("change",h),this.push.removeListener("change",v)):o==="denied"?(this.pull.removeListener("denied",m),this.push.removeListener("denied",y)):o==="active"?(this.pull.removeListener("active",S),this.push.removeListener("active",w)):o==="paused"&&(this.pull.removeListener("paused",g),this.push.removeListener("paused",c))}),this.pull.on("removeListener",p("pull")),this.push.on("removeListener",p("push"));let f=Promise.all([this.push,this.pull]).then(o=>{let u={push:o[0],pull:o[1]};return this.emit("complete",u),i&&i(null,u),this.removeAllListeners(),u},o=>{if(this.cancel(),i?i(o):this.emit("error",o),this.removeAllListeners(),i)throw o});this.then=function(o,u){return f.then(o,u)},this.catch=function(o){return f.catch(o)}}cancel(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())}};function za(t){t.replicate=an,t.sync=Ja,Object.defineProperty(t.prototype,"replicate",{get:function(){var e=this;return typeof this.replicateMethods>"u"&&(this.replicateMethods={from:function(n,r,i){return e.constructor.replicate(n,e,r,i)},to:function(n,r,i){return e.constructor.replicate(e,n,r,i)}}),this.replicateMethods}}),t.prototype.sync=function(e,n,r){return this.constructor.sync(this,e,n,r)}}J.plugin(fa).plugin(pa).plugin(Ba).plugin(za);var yo=J;export{yo as default};

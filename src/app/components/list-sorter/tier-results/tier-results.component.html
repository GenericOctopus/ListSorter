<mat-card class="results-card">
  <mat-card-header>
    <mat-card-title>
      <div class="list-name-container">
        <span *ngIf="!editingListName()" class="list-name-display">
          {{ listName() }} - Tier List
          <button mat-icon-button (click)="startEditingListName()" class="edit-icon-button">
            <mat-icon>edit</mat-icon>
          </button>
        </span>
        <div *ngIf="editingListName()" class="list-name-edit">
          <mat-form-field appearance="outline" class="list-name-field">
            <input 
              matInput 
              [(ngModel)]="editingListNameValue"
              (keyup.enter)="saveListName()"
              (keyup.escape)="cancelEditingListName()"
              placeholder="List name">
          </mat-form-field>
          <button mat-icon-button color="primary" (click)="saveListName()">
            <mat-icon>check</mat-icon>
          </button>
          <button mat-icon-button (click)="cancelEditingListName()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>
    </mat-card-title>
    <mat-card-subtitle>Your personalized ranking organized by tiers (drag items to reorder)</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <!-- Advanced Settings Panel -->
    <app-tier-settings
      [tierPercentages]="tierPercentages()"
      [tierNames]="tierNames()"
      [showAdvancedSettings]="showAdvancedSettings()"
      (showAdvancedSettingsChange)="onShowAdvancedSettingsChange($event)"
      (updateTierPercentage)="onUpdateTierPercentage($event)"
      (validateTierPercentage)="onValidateTierPercentage($event)"
      (recalculateTiers)="onRecalculateTiers()"
      (resetTierPercentages)="onResetTierPercentages()">
    </app-tier-settings>

    <!-- Tier List with Drag & Drop -->
    <div class="tier-container" *ngFor="let tierGroup of tieredItems(); let tierIndex = index">
      <div class="tier-header" [attr.data-tier]="tierGroup.tier">
        <span class="tier-label">{{ tierGroup.tier }}</span>
        <span class="tier-count">{{ tierGroup.items.length }} item{{ tierGroup.items.length !== 1 ? 's' : '' }}</span>
      </div>
      <div 
        class="tier-items"
        cdkDropList
        [id]="'tier-' + tierIndex"
        [cdkDropListData]="tierGroup.items"
        [cdkDropListConnectedTo]="getConnectedLists(tierIndex)"
        (cdkDropListDropped)="onItemDrop($event)">
        <div 
          class="tier-item" 
          *ngFor="let item of tierGroup.items; let itemIndex = index"
          cdkDrag>
          <mat-icon class="drag-handle" cdkDragHandle>drag_indicator</mat-icon>
          
          <span 
            *ngIf="!isEditingItem(tierIndex, itemIndex)" 
            class="item-text"
            (click)="startEditingItem(tierIndex, itemIndex, item)">
            {{ item }}
          </span>
          
          <div *ngIf="isEditingItem(tierIndex, itemIndex)" class="item-edit">
            <mat-form-field appearance="outline" class="item-name-field">
              <input 
                matInput 
                [(ngModel)]="editingItemValue"
                (keyup.enter)="saveItemName(tierIndex, itemIndex, item)"
                (keyup.escape)="cancelEditingItem()"
                placeholder="Item name">
            </mat-form-field>
            <button mat-icon-button color="primary" (click)="saveItemName(tierIndex, itemIndex, item)">
              <mat-icon>check</mat-icon>
            </button>
            <button mat-icon-button (click)="cancelEditingItem()">
              <mat-icon>close</mat-icon>
            </button>
          </div>
          
          <div class="drag-placeholder" *cdkDragPlaceholder></div>
        </div>
      </div>
    </div>
  </mat-card-content>

  <mat-card-actions>
    <button mat-raised-button color="primary" (click)="copyToClipboard()">
      <mat-icon>content_copy</mat-icon>
      Copy to Clipboard
    </button>
    <button mat-raised-button color="accent" (click)="onHideResults()">
      <mat-icon>edit</mat-icon>
      Add More Items
    </button>
    <button mat-raised-button color="warn" (click)="onResortEntireList()">
      <mat-icon>refresh</mat-icon>
      Resort Entire List
    </button>
    <button mat-raised-button color="primary" (click)="onCreateNewList()">
      <mat-icon>add</mat-icon>
      Create New List
    </button>
  </mat-card-actions>
</mat-card>

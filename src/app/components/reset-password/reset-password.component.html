<div class="reset-password-container">
  <mat-card class="reset-password-card">
    <mat-card-header>
      <mat-card-title>Set New Password</mat-card-title>
    </mat-card-header>
    
    <mat-card-content>
      @if (invalidLink) {
        <div class="invalid-link-message">
          <mat-icon class="error-icon">error</mat-icon>
          <h3>Invalid Reset Link</h3>
          <p>
            This password reset link is invalid or has expired.
            Please request a new password reset.
          </p>
          <button
            mat-raised-button
            color="primary"
            routerLink="/forgot-password"
            class="full-width"
          >
            Request New Link
          </button>
        </div>
      } @else if (!success) {
        <p class="instructions">
          Enter your new password below. Make sure it's at least 8 characters long.
        </p>

        <form (ngSubmit)="onSubmit()" #resetForm="ngForm">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>New Password</mat-label>
            <input
              matInput
              type="password"
              [(ngModel)]="password"
              name="password"
              required
              minlength="8"
              [disabled]="loading"
              autocomplete="new-password"
            />
            <mat-hint>At least 8 characters</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Confirm Password</mat-label>
            <input
              matInput
              type="password"
              [(ngModel)]="passwordConfirm"
              name="passwordConfirm"
              required
              [disabled]="loading"
              autocomplete="new-password"
            />
          </mat-form-field>

          @if (error) {
            <div class="error-message">
              <mat-icon>error</mat-icon>
              {{ error }}
            </div>
          }

          <button
            mat-raised-button
            color="primary"
            type="submit"
            class="full-width"
            [disabled]="loading || !resetForm.valid"
          >
            @if (loading) {
              <mat-spinner diameter="20"></mat-spinner>
            } @else {
              Reset Password
            }
          </button>
        </form>
      } @else {
        <div class="success-message">
          <mat-icon class="success-icon">check_circle</mat-icon>
          <h3>Password Reset Successful!</h3>
          <p>
            Your password has been successfully reset.
            You will be redirected to the login page in a moment.
          </p>
          <button
            mat-raised-button
            color="primary"
            routerLink="/login"
            class="full-width"
          >
            Go to Login
          </button>
        </div>
      }

      @if (!invalidLink && !success) {
        <div class="back-link">
          <a routerLink="/login">
            <mat-icon>arrow_back</mat-icon>
            Back to Login
          </a>
        </div>
      }
    </mat-card-content>
  </mat-card>
</div>
